\chapter{The MIT Bag Model}
\label{chap:mit}

To illustrate some of the concepts in \cref{chap:master_intro} and gently familiarize ourselves with additional ones,
let us first model quark stars consisting of a free Fermi gas of quarks with the \textbf{MIT bag model}.
Originally introduced by \cite{ref:mit_bag_model_original} at MIT,
this simple phenomenological model accounts for confinement of quarks in hadrons by adding a \textbf{bag constant} $B$ on top of a normal deconfined ideal Fermi gas.
We will see how $B$ can be interpreted as an external pressure that effectively describes an enclosed \emph{bag}
that resists stretching and groups quarks,
as if they are trapped in a balloon that represents a hadron.
However, we will also see that this confinement effect is suppressed in the modeled quark stars,
which then consist only of \emph{deconfined} quark matter,
as if the balloon has burst and the quarks have escaped.
Moreover, we will discuss instability of two-flavor quark matter compared to hadronic matter 
and the \textbf{strange matter hypothesis} of three-flavor quark matter being its absolute ground state,
and see how this can be used to determine a \textbf{bag window} of acceptable values for $B$.

\textit{This chapter is inspired by references \cite{ref:glendenning} and \cite{ref:quark_bag_model}.}

\section{Lagrangian, grand potential and equation of state}
\label{sec:mit:eos}

We will start by simply ignoring the gluon fields $A_\mu^a$ in the quantum chromodynamics Lagrangian \eqref{eq:qcd:lagrangian}
with the three lightest quark flavors $f=\{u,d,s\}$.
In addition, we couple the conserved vector current $\smash{j_f^\mu} = \bar{q}_f \gamma^\mu q_f$ to a chemical potential $\mu_f$ for each flavor,
allowing us to tune the densities \eqref{eq:master_intro:densities} of quarks.
%\footnote{For an explanation of how the chemical potentials can be thought of as an analogy to constant gauge fields,
%the interested reader can consult the discussion surrounding equations \eqref{eq:tft:conserved_current}--\eqref{eq:tft:chemical_potential}.}
With these modifications, the Lagrangian becomes
\begin{equation}
	\lagr = \bar{q} (i \slashed\partial + \mu \gamma^0 - m) q
	      = \sum_{c=1}^{N_c} \sum_{f=1}^{\smash{N_f}} \bar{q}_{f,c} (i \slashed\partial + \mu_f \gamma^0 - m_f) q_{f,c} .
\label{eq:mit:lagrangian}
\end{equation}
In this model the two-flavor and three-flavor analyses are very similar, so we consider them in parallel.
Unless $N_f$ is specified explicitly, we perform the general analysis with $N_f=3$, or $f=\{u,d,s\}$,
and simply drop terms or factors indexed by the strange quark $s$ to get expressions for $N_f = 2$, or $f=\{u,d\}$.
As we have simply omitted the gluons, we set the quark masses $m_f$ to the lone quark masses in \cref{tab:qcd:quark_properties}.

With the Euclidean version $\lagr_E$ of the Lagrangian \eqref{eq:mit:lagrangian},
the partition function \eqref{eq:master_intro:partition_function} reads
\begin{equation}
\begin{split}
	%Z &= \oint_- \pathintdif \bar{q} \oint_- \pathintdif q \exp \bigg\{ \int_0^\beta \dif \tau \int_V \dif^3 x \, \lagr_E [q,\bar{q}] \bigg\} \\
	Z &= \oint_- \pathintdif \bar{q} \oint_- \pathintdif q \exp \bigg\{ \int_0^\beta \dif \tau \int_V \dif^3 x \, \bar{q} \big( i \slashed\partial + \mu_f \gamma^0 - m_f) q \bigg\} \\
	  &= \prod_{c=1}^{N_c} \prod_{f=1}^{\smash{N_f}} \oint_- \pathintdif \bar{q}_{f,c} \oint_- \pathintdif q_{f,c} \exp \bigg\{ \int_0^\beta \dif \tau \int_V \dif^3 x \, \bar{q}_{f,c} \big( i \slashed\partial + \mu_f \gamma^0 - m_f) q_{f,c} \bigg\} \\
\end{split}
\end{equation}
It decouples into a product of $N_c \times N_f$ path integrals \eqref{eq:tft:dirac_partition_function_first} that we encountered back in \cref{chap:tft}
and simplified to the form \eqref{eq:tft:dirac_partition_function} for arbitrary temperature.
In \cref{chap:nstars} we neglected the divergent vacuum contribution from the first term and calculated the path integral explicitly in the zero-temperature approximation,
arriving at the pressure \eqref{eq:nstars:pressure_zeroT} that is related to the grand potential density $\Omega$ by the simple sign flip \eqref{eq:master_intro:pressure}.
The path integrals differ only by the unique chemical potentials $\smash{\mu_f}$ associated with each quark flavor.
Adding a background of free electrons and reinstating $x_f = p_f / m_f = \sqrt{\smash[b]{\mu_f^2-m_f^2}} / m_f$ for each particle species,
we can write the grand potential as
\begin{equation}
\begin{split}
	\Omega(\vec{\mu}) = &-\sum_{f=1}^{\smash{N_f}} \frac{N_c}{24 \pi^2} \left[ \left( 2 \mu_f^2 - 5 m_f^2 \right) \mu_f \sqrt{\mu_f^2 - m_f^2} + 3 m_f^4 \asinh \left( \sqrt{\frac{\mu_{\smash{f}}^2}{m_f^2}-1} \right) \right] \\
	                    &-\phantom{\sum} \, \frac{1}{24 \pi^2} \left[ \left( 2 \mu_e^2 - 5 m_e^2 \right) \mu_e \sqrt{\mu_e^2 - m_e^2} \, \, + \, 3 m_e^4 \asinh \left( \sqrt{\frac{\mu_{\smash{e}}^2}{m_e^2}-1} \right) \right].
\label{eq:mit:grand_potential}
\end{split}
\end{equation}
This expression is only valid when $\mu_i \geq m_i$,
as we assumed so during calculation of the zero-temperature pressure integral \eqref{eq:nstars:pressure_zeroT} containing the step function $\Theta(\mu_i-\sqrt{\smash[b]{m_i^2-p^2}})$.
In the opposite case $\mu_i < m_i$, this step function would be turned off for all $p$ and make the integral vanish.
Equivalently, we can consider the grand potential above valid for \emph{all} $\mu_i$ if we implicitly take its \emph{real part}.
Adopting this convention, the corresponding quark and electron densities \eqref{eq:master_intro:densities} are
\begin{equation}
	n_f = -\pdv{\Omega}{\mu_f} = \frac{N_c}{3 \pi^2} \Big( \mu_f^2 - m_f^2 \Big)^{\frac32}
	\qquad \text{and} \qquad
	n_e = -\pdv{\Omega}{\mu_e} = \frac{  1}{3 \pi^2} \Big( \mu_e^2 - m_e^2 \Big)^{\frac32},
\label{eq:mit:particle_densities}%
\end{equation}
and the pressure \eqref{eq:master_intro:pressure} and energy density \eqref{eq:master_intro:energy_density} easily follow with $T=0$.

We now see explicitly that $\Omega$ and hence $P$ and $\epsilon$ are functions of the four chemical potentials $\mu_u$, $\mu_d$, $\mu_s$ and $\mu_e$.
As explained in \cref{sec:master_intro:tft},
we reduce them to a single independent chemical potential with the three constraints \eqref{eq:lsm:chemical_equilibrium} and \eqref{eq:lsm:charge_neutrality},
and take it to be the quark chemical potential $\mu$ defined in equation \eqref{eq:master_intro:chemical_potentials_transformed}.
Inserting $N_c=3$, the charges in \cref{tab:qcd:quark_properties} and the densities \eqref{eq:mit:particle_densities},
the charge neutrality condition \eqref{eq:lsm:charge_neutrality} to be solved is
\begin{equation}
	2 \Big(\mu_u^2-m_u^2\Big)^\frac32
	- \Big(\mu_d^2-m_d^2\Big)^\frac32 
	- \Big(\mu_s^2-m_s^2\Big)^\frac32 
	- \Big(\mu_e^2-m_e^2\Big)^\frac32 = 0.
\label{eq:mit:charge_neutrality_explicit}
\end{equation}
To solve it for a given value of $\mu=(\mu_u+\mu_d)/2$,
first note that $\{\mu,\mu_e\}$
can be translated to $\{\mu_u,\mu_d,\mu_s\}$ with the $\beta$-equilibrium constraint \eqref{eq:lsm:chemical_equilibrium}.
For a given value of $\mu$, we then vary $\mu_e$ until we have found the solution of equation \eqref{eq:mit:charge_neutrality_explicit}.
Repeating this procedure for a range of $\mu$,
we parametrize the pressure $P(\mu)$ and energy density $\epsilon(\mu)$ as functions of $\mu$.
We then invert $P(\mu)$ to $\mu(P)$ and insert it into $\epsilon(\mu)$ to obtain the equation of state $\epsilon(P)$.

\begin{figure}
\centering
\tikzsetnextfilename{mit-eos}
\begin{tikzpicture}
\tikzset{declare function={
	muQ(\muu,\mud)=(\muu+\mud)/2;
	muu(\muQ)=2/(1+2^(1/3))*\muQ;
	mud(\muQ)=2/(1+2^(-1/3))*\muQ;
	mue(\muQ)=2*(2^(1/3)-1)/(2^(1/3)+1)*\muQ;
	nq(\mu)=3/(3*pi^2)*(\mu)^3;
	ne(\mu)=1/(3*pi^2)*(\mu)^3;
	nconv=1.29619e-7;
}};
\begin{groupplot}[
	group style={group size={1 by 3}, vertical sep=1.1cm},
	width=13cm, height=8cm,
	extra tick style={grid=major, grid style={dashed}},
	minor tick num=9,
	xlabel style={yshift=+0.1cm},
	legend style={xshift=-0.2cm, yshift=-0.5cm, fill=none},
	every axis title/.style={anchor=west, at={(0.01, 0.95)}, align=left, text width=5.0cm},
]
\nextgroupplot[
	xlabel={$\mu \, / \, \si{\mega\electronvolt}$}, ylabel={$\mu_i \, / \, \si{\mega\electronvolt}$},
	%xmin=0, xmax=600, ymax=500, xtick distance=100, ytick distance=100, minor x tick num=9,
	xmin=0, xmax=700, xtick distance=100, minor x tick num=9,
	ymin=0, ymax=700, ytick distance=100, 
	%ymax=600, 
	title={\subcaption{\label{fig:mit:eos-parametrization}\makebox[\widthof{Parametrization of solutions}][l]{Parametrization of solutions}}},
	legend cell align=left, legend pos=north west,
];
% fake legend
\addplot+ [black, solid, very thick, opacity=0.5] {-100}; \addlegendentry{$N_f=2$};
\addplot+ [black, solid, very thick, opacity=1.0] {-100}; \addlegendentry{$N_f=3$};
\addplot+ [index of colormap={0 of Set1-9}, solid, very thick, opacity=1.0] {-100}; \addlegendentry{$\mu_u$};
\addplot+ [index of colormap={2 of Set1-9}, solid, very thick, opacity=1.0] {-100}; \addlegendentry{$\mu_d$};
\addplot+ [index of colormap={6 of Set1-9}, solid, very thick, opacity=1.0] {-100}; \addlegendentry{$\mu_s$};
\addplot+ [index of colormap={1 of Set1-9}, solid, very thick, opacity=1.0] {-100}; \addlegendentry{$\mu_e$};

% 2-flavor
\addplot+ [index of colormap={0 of Set1-9}, solid,  very thick, opacity=0.5] table [x expr={muQ(\thisrow{muu},\thisrow{mud})}, y=muu] {../code/data/MIT2F/eos_sigma_0.dat};
\addplot+ [index of colormap={2 of Set1-9}, solid,  very thick, opacity=0.5] table [x expr={muQ(\thisrow{muu},\thisrow{mud})}, y=mud] {../code/data/MIT2F/eos_sigma_0.dat};
\addplot+ [index of colormap={1 of Set1-9}, solid,  very thick, opacity=0.5] table [x expr={muQ(\thisrow{muu},\thisrow{mud})}, y=mue] {../code/data/MIT2F/eos_sigma_0.dat};

% 3-flavor
\addplot+ [index of colormap={0 of Set1-9}, solid,  very thick, opacity=1.0] table [x expr={muQ(\thisrow{muu},\thisrow{mud})}, y=muu] {../code/data/MIT3F/eos_sigma_0.dat};
\addplot+ [index of colormap={2 of Set1-9}, solid,  very thick, opacity=1.0] table [x expr={muQ(\thisrow{muu},\thisrow{mud})}, y=mud] {../code/data/MIT3F/eos_sigma_0.dat};
\addplot+ [index of colormap={6 of Set1-9}, dashed, very thick, opacity=1.0] table [x expr={muQ(\thisrow{muu},\thisrow{mud})}, y=mus] {../code/data/MIT3F/eos_sigma_0.dat};
\addplot+ [index of colormap={1 of Set1-9}, solid,  very thick, opacity=1.0] table [x expr={muQ(\thisrow{muu},\thisrow{mud})}, y=mue] {../code/data/MIT3F/eos_sigma_0.dat};

\nextgroupplot[
	xlabel={$\mu \, / \, \si{\mega\electronvolt}$}, ylabel={$n_i \, / \, (1/\si{\femto\meter\cubed})$},
	xmin=0, xmax=700, xtick distance=100, minor x tick num=9,
	ymin=-0.2, ymax=5.0, ytick distance=1.0, minor y tick num=4, restrict y to domain=-10:10,
	title={\subcaption{\label{fig:mit:eos-density}\makebox[\widthof{Parametrization of solutions}][l]{Particle number densities}}},
	legend cell align=left, legend pos=north west,
];
% fake legend
\addplot+ [black, solid, very thick, opacity=0.5] {-10}; \addlegendentry{$N_f=2$};
\addplot+ [black, solid, very thick, opacity=1.0] {-10}; \addlegendentry{$N_f=3$};
\addplot+ [index of colormap={0 of Set1-9}, solid, very thick, opacity=1.0] {-10}; \addlegendentry{$n_u$};
\addplot+ [index of colormap={2 of Set1-9}, solid, very thick, opacity=1.0] {-10}; \addlegendentry{$n_d$};
\addplot+ [index of colormap={6 of Set1-9}, solid, very thick, opacity=1.0] {-10}; \addlegendentry{$n_s$};
\addplot+ [index of colormap={1 of Set1-9}, solid, very thick, opacity=1.0] {-10}; \addlegendentry{$n_e$};

% 2-flavor
\addplot+ [index of colormap={0 of Set1-9}, solid, very thick, opacity=0.5] table [x expr={muQ(\thisrow{muu},\thisrow{mud})}, y=nu] {../code/data/MIT2F/eos_sigma_0.dat};
\addplot+ [index of colormap={2 of Set1-9}, solid, very thick, opacity=0.5] table [x expr={muQ(\thisrow{muu},\thisrow{mud})}, y=nd] {../code/data/MIT2F/eos_sigma_0.dat};
\addplot+ [index of colormap={1 of Set1-9}, solid, very thick, opacity=0.5] table [x expr={muQ(\thisrow{muu},\thisrow{mud})}, y=ne] {../code/data/MIT2F/eos_sigma_0.dat};

% 3-flavor
\addplot+ [index of colormap={0 of Set1-9}, solid, very thick, opacity=1.0] table [x expr={muQ(\thisrow{muu},\thisrow{mud})}, y=nu] {../code/data/MIT3F/eos_sigma_0.dat};
\addplot+ [index of colormap={2 of Set1-9}, solid, very thick, opacity=1.0] table [x expr={muQ(\thisrow{muu},\thisrow{mud})}, y=nd] {../code/data/MIT3F/eos_sigma_0.dat};
\addplot+ [index of colormap={6 of Set1-9}, solid, very thick, opacity=1.0] table [x expr={muQ(\thisrow{muu},\thisrow{mud})}, y=ns] {../code/data/MIT3F/eos_sigma_0.dat};
\addplot+ [index of colormap={1 of Set1-9}, solid, very thick, opacity=1.0] table [x expr={muQ(\thisrow{muu},\thisrow{mud})}, y=ne] {../code/data/MIT3F/eos_sigma_0.dat};

\nextgroupplot[
	xlabel={$P        \, / \, (\si{\giga\electronvolt\per\femto\meter\cubed})$},
	ylabel={$\epsilon \, / \, (\si{\giga\electronvolt\per\femto\meter\cubed})$},
	xmin=0, xmax=0.30, ymin=0, ymax=1.0, xtick distance=0.10, minor x tick num=9, ytick distance=0.5, minor y tick num=4, restrict y to domain=-1:+1,
	title={\subcaption{\label{fig:mit:eos-eos}\makebox[\widthof{Parametrization of solutions}][l]{Equation of state}}},
	legend cell align=left, legend pos=north west,
];
\addplot+ [black, solid, very thick, opacity=0.5] table [x=P,y=epsilon] {../code/data/MIT2F/eos_sigma_0.dat}; \addlegendentry{$N_f=2$};
\addplot+ [black, solid, very thick, opacity=1.0] table [x=P,y=epsilon] {../code/data/MIT3F/eos_sigma_0.dat}; \addlegendentry{$N_f=3$};
\end{groupplot}
\end{tikzpicture}
\caption{\label{fig:mit:eos}%
Properties of charge neutral two-flavor (weak lines) and three-flavor (strong lines) quark matter in $\beta$-equilibrium in the MIT bag model.
Upper panel \subref{fig:mit:eos-parametrization} shows the relations between chemical potentials due to the constraints \eqref{eq:lsm:chemical_equilibrium} and \eqref{eq:lsm:charge_neutrality},
middle panel \subref{fig:mit:eos-density} the particle number densities \eqref{eq:mit:particle_densities} and
lower panel \subref{fig:mit:eos-eos} the equation of state \TODO{fix. all very thick? captions. two legend columns?}.
}
\end{figure}

\subsubsection{Ultra-relativistic limit}

Before tackling the general solution numerically,
it is instructive and in fact not far from accurate to solve this problem analytically in the ultra-relativistic limit $m_i = 0$.
The grand potential \eqref{eq:mit:grand_potential} then reduces to
\begin{equation}
	\Omega(\vec{\mu}) = -\frac{N_c \mu_u^4}{12 \pi^2} - \frac{N_c \mu_d^4}{12 \pi^2} - \frac{N_c \mu_s^4}{12 \pi^2} - \frac{\mu_e^4}{12 \pi^2},
\label{eq:mit:grand_potential_massless}
\end{equation}
while the densities \eqref{eq:mit:particle_densities} become
\begin{equation}
	n_f = \frac{N_c \mu_f^3}{3 \pi^2}
	\qquad \text{and} \qquad
	n_e = \frac{    \mu_e^3}{3 \pi^2}.
\label{eq:mit:densities_massless}
\end{equation}
\emph{Regardless} of the relations between the chemical potentials,
the equation of state is then simply
\begin{equation}
	\epsilon \equalexplbelow{\text{by \eqref{eq:master_intro:energy_density}}} -P + \sum_i \mu_i n_i
	         \equalexplbelow{\text{by \eqref{eq:mit:densities_massless}}} -P + \frac{1}{3 \pi^2} \Big(N_c \mu_u^4 + N_c \mu_d^4 + N_c \mu_s^4 + \mu_e^4\Big)
	         \equalexplbelow{\text{by \eqref{eq:mit:grand_potential_massless}}} -P - 4 \Omega 
	         \equalexplbelow{\text{by \eqref{eq:master_intro:pressure}}} -P + 4 P 
	         = 3 P \, !
\label{eq:mit:eos_ur}
\end{equation}
Although they are not needed for the equation of state,
we can also find approximate analytical relations between the chemical potentials in the ultra-relativistic limit.
They will be useful to compare with the general numerical solution, for which the equation of state \emph{does} depend on these relations.
To do so, we assume that the electron density in the charge neutrality condition \eqref{eq:mit:charge_neutrality_explicit} can be neglected.
This assumption is subject to a self-consistency check down the line.

In the two-flavor case, this simplifies the charge neutrality condition \eqref{eq:mit:charge_neutrality_explicit} to $\mu_d^3 = 2 \mu_u^3$, or $n_d = 2 n_u$, with the solution $\mu_d = 2^{1/3} \mu_u$.
According to the $\beta$-equilibrium condition \eqref{eq:lsm:chemical_equilibrium}
the chemical potential of the electrons is then $\mu_e = \mu_d - \mu_u \approx (2^{1/3}-1) \mu_u$,
and the corresponding electron density \eqref{eq:mit:densities_massless} is $n_e = (2^{1/3}-1)^3 n_u / N_c = 0.006 \, n_u \ll n_u < n_d$,
so neglecting it is a self-consistent approximation!
Expressing the chemical potentials in terms of the quark chemical potential \eqref{eq:master_intro:chemical_potentials_transformed},
we then have
\begin{subequations}
\begin{flalign}
	&&
	\mu_u = \underbrace{\frac{2}{1+2^{1/3}}}_{0.88} \mu , \quad
	\mu_d = \underbrace{\frac{2}{1+2^{-1/3}}}_{1.12} \mu \quad \text{and} \quad
	\mu_e = \underbrace{\frac{2\left(2^{1/3}-2^{-1/3}\right)}{2+2^{1/3}+2^{-1/3}}}_{0.23} \mu
	&& (N_f = 2). \phantom{1} \,\,  % \phantom{1} for (7.9) vs (7.10)
\label{eq:mit:chemical_potentials_massless_2f}
\end{flalign}
With three flavors, the charge neutrality condition \eqref{eq:mit:charge_neutrality_explicit} becomes $2 n_u - n_d - n_s = 0$
after neglecting electrons.
It has the very simple solution $n_u = n_d = n_s$ with
\begin{flalign}
	&&
	\mu_u = \mu_d = \mu_s = \mu
	\quad \text{and} \quad
	\mu_e = 0
	&& (N_f = 3). \,\, 
\label{eq:mit:chemical_potentials_massless_3f}
\end{flalign}%
\label{eq:mit:chemical_potentials_massless}%
\end{subequations}%
As $\mu_e = \mu_d - \mu_u = 0$, neglecting the electron contribution is exact in this case.

\subsubsection{General solution}

We now calculate the general solution with massive quarks using the program in \cref{sec:num:qstars2f},
solving equation \eqref{eq:mit:charge_neutrality_explicit} numerically for different quark chemical potentials $\mu$.
We obtain the chemical potentials, densities and equation of state shown in \cref{fig:mit:eos}.
Note that the electron density is very small, but nonzero.
Indeed, the results are very close to the straight-line ultra-relativistic relations
\eqref{eq:mit:densities_massless}-\eqref{eq:mit:chemical_potentials_massless_3f}
as $\mu_i \gg m_i$, thereby supporting our numerical calculations.


\section{Bag constant and the strange matter hypothesis}

For chemical potentials $\mu_i < m_i$ the (real part of the) densities \eqref{eq:mit:particle_densities} vanish,
so we refer to this region of the phase diagram as the \textbf{vacuum phase}.
So far we have modeled the quarks as a free Fermi gas of \emph{deconfined} quarks.
We know, however, that quarks are \emph{confined} in hadrons at low energies.
Let us see how the MIT bag model attempts to incorporate confinement with the so-called bag constant.

The pressure $P = -\Omega$ due to the grand potential density \eqref{eq:mit:grand_potential} is normalized to $P = 0$ in the vacuum.
Suppose that we shift $\Omega \rightarrow \Omega + B$ by a \textbf{vacuum constant} $B$.
This in turn shifts the pressure \eqref{eq:master_intro:pressure} and energy density \eqref{eq:master_intro:energy_density} to
\begin{equation}
	P(\mu) \rightarrow P(\mu) - B
	\qquad \text{and} \qquad
	\epsilon(\mu) \rightarrow \epsilon(\mu) + B,
\label{eq:mit:bag_shift}
\end{equation}
effectively moving the equation of state in \cref{fig:mit:eos-eos} north-west in $P$-$\epsilon$-space.
The vacuum constant is hence a phenomenological parameter
that adjusts the normalization of the grand potential in vacuum,
and hence the zero-point energy and pressure, and the equation of state.

\begin{figure}[t]
\centering

\pgfmathdeclarerandomlist{randcolors}{{red}{green}{blue}}
\pgfmathdeclarerandomlist{randflavors}{{u}{d}{s}}
\newcommand{\fillrandomly}[6]{

	\def\xlist{4} % TODO: ???
	\def\ylist{4}
    \pgfmathsetmacro\diameter{#5*2}
    %\draw (0,0) rectangle (#3,#4);
    \foreach \i in {1,...,#6}{
        \pgfmathsetmacro\x{#1+rnd*#3}
        \pgfmathsetmacro\y{#2+rnd*#4}
        \xdef\collision{0}
        \foreach \element [count=\i] in \xlist{
            \pgfmathtruncatemacro\j{\i-1}
            \pgfmathsetmacro\checkdistance{ sqrt( ({\xlist}[\j]-(\x))^2 + ({\ylist}[\j]-(\y))^2 ) }
            \ifdim\checkdistance pt<\diameter pt
                \xdef\collision{1}
                \breakforeach
            \fi
        }
        \ifnum\collision=0
            \xdef\xlist{\xlist,\x}
            \xdef\ylist{\ylist,\y}
			\pgfmathrandomitem\thecolor{randcolors}
			\edef\thecolor{\thecolor}%
			\pgfmathrandomitem\theflavor{randflavors}
			\edef\theflavor{\theflavor}%
			\draw [draw=black, fill=\thecolor] (\x, \y) circle (#5) node [text=white] {$\theflavor$};
        \fi

    }
}

%\subcaptionbox{\label{fig:mit:bag-constant-confined}confined phase}{
\centering
\tikzsetnextfilename{bag-constant-confined}
\begin{tikzpicture}
\draw [draw=black, fill=gray] (-3, -3) rectangle (+3, +3);

\draw [draw=black, fill=white] (0, 0) circle (2);
%\begin{scope}[blend group=screen]
	\draw [draw=black, fill=green] ( 30:0.9) circle (0.40) node [text=white] {$d$};
	\draw [draw=black, fill=red]   (150:0.9) circle (0.40) node [text=white] {$u$};
	\draw [draw=black, fill=blue]  (270:0.9) circle (0.40) node [text=white] {$d$};

	% kinetic pressure
	\draw [gray, very thick, -Latex] ( 30:1.4) -- ( 30:1.9);
	\draw [gray, very thick, -Latex] (150:1.4) -- (150:1.9);
	\draw [gray, very thick, -Latex] (270:1.4) -- (270:1.9);

	% bag pressure
	\draw [very thick, -Latex] ( 30:2.6) -- ( 30:2.1);
	\draw [very thick, -Latex] (150:2.6) -- (150:2.1);
	\draw [very thick, -Latex] (270:2.6) -- (270:2.1);
%\end{scope}
%\node at (0, -0.25) {$P=-B$};
\node at (0, 1.3) {$P=-B$};
\node [anchor=south west] at (-2.7, -2.7) {$P=0$};

%\node at (90:1.3) {  confined vacuum};
%\node at (90:2.5) {deconfined vacuum};
\node at (90:2.5) [text width=5cm] {\subcaption{\label{fig:mit:bag-constant-confined}confined phase} };
%\subcaptionbox{\label{fig:mit:bag-constant-deconfined}deconfined phase}{

\end{tikzpicture}
%}
%\subcaptionbox{\label{fig:mit:bag-constant-deconfined}deconfined phase}{
\centering
\tikzsetnextfilename{bag-constant-deconfined}
\begin{tikzpicture}
\clip (-3, -3) rectangle (+3, +3);
\draw [draw=black, fill=gray] (-3, -3) rectangle (+3, +3);
\draw [draw=black, fill=white] (0, 0) circle (3.6);
\draw [draw=black, opacity=0.3, loosely dashed] (+6, 0) circle (3.6);
\draw [draw=black, opacity=0.3, loosely dashed] (-6, 0) circle (3.6);
\draw [draw=black, opacity=0.3, loosely dashed] (0, +6) circle (3.6);
\draw [draw=black, opacity=0.3, loosely dashed] (0, -6) circle (3.6);
%\pgfmathsetseed{93209302}
\pgfmathsetseed{93209303}
%\node at (90:2.5) {deconfined vacuum};
\node [anchor=south] at (0, -2.7) {$P \rightarrow \infty$};
\node at (90:2.5) [text width=5cm] {\phantomsubcaption\subcaption{\label{fig:mit:bag-constant-deconfined}deconfined phase}};
\fillrandomly{-2.6}{-2.6}{5.2}{4.5}{0.40}{80}
\end{tikzpicture}
%}
\caption{\label{fig:mit:bag_constant}%
	The bag constant $B$ allows for negative pressure and is often interpreted as a confinement mechanism.
	A negative internal pressure is equivalent to a positive external pressure
	that effectively traps quarks in a hadron-resembling \emph{bag} or \emph{balloon}
	in the confined phase \subref{fig:mit:bag-constant-confined}.
	At large positive pressure, the balloon inflates and merges with adjacent balloons,
	effectively bursting as the quarks escape to take part in the deconfined quark matter phase \subref{fig:mit:bag-constant-deconfined}.
	\iffalse
	The bag constant $B$ can be interpreted as the pressure difference between two deconfined and confined vacuum phases.
	In the confined phase \subref{fig:mit:bag-constant-confined},
	a surrounding quark-forbidden deconfined medium may pressurize hadronic ``bags''
	inside which quarks are trapped and stabilize the bag by exerting a counteracting kinetic pressure.
	For large internal pressures, the bag 
	In the deconfined phase \subref{fig:mit:bag-constant-deconfined} there is no bag pressure,
	so the bags open up and the quarks break free into deconfined quark matter.
	\fi
}
\end{figure}

As illustrated in \cref{fig:mit:bag_constant},
a positive vacuum constant $B$ creates a negative pressure $P = -B$ in the vacuum.
This is commonly interpreted as an external pressure or mechanism that \emph{confines} quarks to \emph{bags} or \emph{balloons} that resemble hadrons,
so $B$ is often called the \textbf{bag constant}%
%\footnote{Interpreting the effects of the bag constant $B$ as a balloon, it could certainly be called the \emph{balloonstant}!}%
.
With rising density, the quarks in the bag exert a counteracting outwards pressure that stabilizes the hadron at $P=0$,
like a balloon that has reached equilibrium with its surroundings.
With large positive pressures $P \rightarrow \infty$, the balloon inflates and merges with nearby balloons,
effectively bursting as the quarks escape to take part in a phase of deconfined quark matter.

\iffalse
A positive vacuum constant $B$ creates a negative pressure $P = -B$ in the vacuum.
In a sense, it can therefore be interpreted as a mechanism that \emph{confines} the quarks to ``bags'' that resemble hadrons.
Due to this common physical interpretation, $B$ is often called the \textbf{bag constant}.
The quarks in the bag exert an outwards kinetic pressure that counteracts the external bag pressure and stabilizes the hadron.
%From inside the bag, the quarks exert an outwards kinetic pressure that counteracts the external bag pressure and stabilizes the hadron.
The bag constant can therefore be interpreted as the pressure difference between two phases of confined and deconfined vacuum,
as illustrated in \cref{fig:mit:bag_constant}.
\fi

As another analogy, imagine a swimming pool full of water representing the gray quark-forbidden medium.
It would cost an amount $BV$ of energy to expel water from a volume $V$ and create a confined vacuum in the pool,
and a plastic bag enclosing this volume would have to generate some internal pressure to survive against the pressure from the surrounding water.

Despite the common interpretation of $B$ as a confinement mechanism,
it is very important to note that the quark stars we will model 
will be integrated from a positive central pressure to a vanishing pressure at the surface,
and therefore have \emph{non-negative pressure} everywhere and more or less only contain \emph{deconfined} quark matter.
As explained in \cref{sec:master_intro:tov}, the integration of the Tolman-Oppenheimer-Volkoff equation stops when it reaches the surface defined by $P=0$,
so the confinement-interpretable part of the equation of state with negative pressure that arises due to the shift \eqref{eq:mit:bag_shift} is \emph{unused} in a quark star!
We should therefore not take the confinement interpretation too literally in our case.
Nevertheless, the bag shift \eqref{eq:mit:bag_shift} affects the equation of state even in the deconfined regime,
so it is perhaps better to think of $B$ only as a phenomenological parameter that we can vary to adjust the normalization of the grand potential
and -- as we will see shortly -- a parameter that determines 
the stability of quark matter compared to hadronic matter.

What values can the bag constant take?
Let us perform a heuristic calculation where we picture quarks to be confined in a spherical bag of radius $R$, as depicted in \cref{fig:mit:bag-constant-confined}.
The vacuum energy associated with the mere existence of this bag is $E_V = 4 \pi R^3 B / 3$.
By Heisenberg's uncertainty principle $\Delta p \Delta x \geq \hbar/2$, a quark confined to a region extending $\Delta x = 2R$ in one dimension with \emph{mean} momentum $\avg{p} = 0$ has momentum $p \lesssim \hbar/4R \propto 1/R$.
In the ultra-relativistic regime where we can neglect the particles' masses, the kinetic energy inside the bag is therefore $E_K = pc = C / R$ for some constant $C$.
As a function of $R$, the total energy $E = E_V + E_K = 4 \pi R^3 B / 3 + C/R$ has a minimum at $R = (C/4 \pi B)^{1/4}$ for which the bag is stable.
Eliminating $C$, the energy of this stable configuration is $E = 16 \pi R^3 B / 3$.
Assuming a neutron with total energy $E = m c^2 = \SI{900}{\mega\electronvolt}$ and radius $R \approx \SI{1}{\femto\meter} = 1 / \SI{197}{\mega\electronvolt}$ in natural units,
the ``optimal'' bag constant is
\begin{equation}
	B = \frac{3 E}{16 \pi R^3} = (\SI{142.4}{\mega\electronvolt})^4.
\label{eq:mit:bag_constant_optimal}
\end{equation}

\pagebreak
Another approach lets us determine a \emph{range} of values for the bag constant.
In the early days with high density and temperature, the universe likely passed through a phase of deconfined quark-gluon plasma. \cite{ref:glendenning}
Today, two-flavor quark matter is accreting in nuclei through fusion towards iron-56 in stars, which seemingly represent the ground state of nuclear matter.
However, the \textbf{strange matter hypothesis} of \cite{ref:strange_hypothesis_bodmer,ref:strange_hypothesis_witten} conjectures that this state is only \emph{metastable}
and could decay further to the hypothesized absolute ground state of three-flavor quark matter consisting of up, down and strange quarks.
If true, the universe could turn into a very \emph{strange} place some day.

Iron-56 is the most stable nuclide with an energy of $E/N_B = \epsilon/n_B = \SI{930}{\mega\electronvolt}$ per baryon. \cite{ref:glendenning}
If we denote the energy densities of two-flavor and three-flavor quark matter by $\epsilon_2$ and $\epsilon_3$,
then the instability of two-flavor quark matter
and hypothesized stability of three-flavor quark matter
at zero pressure $P=0$,
which characterizes equilibrium of a system,
imply the double inequality
\begin{equation}
	\frac{\epsilon_3(P=0)}{n_B} \leq \SI{930}{\mega\electronvolt} \leq \frac{\epsilon_2(P=0)}{n_B} .
\label{eq:mit:bag_stability}
\end{equation}
We will now see that this yields a range of bag constants that we call a \textbf{bag window}.

\subsubsection{Ultra-relativistic bag window}

Let us first examine how the ultra-relativistic equation of state is affected by the addition of a bag constant,
and how inequality \eqref{eq:mit:bag_stability} generates a corresponding bag window.
The bag shift \eqref{eq:mit:bag_shift} changes the equation of state \eqref{eq:mit:eos_ur} to $\epsilon = 3 P + 4 B$.
Neglecting electrons again, the baryon density is always $n_B = (n_u+n_d+n_s)/3 = n_u = \mu_u^3 / \pi^2$,
since $n_d = 2 n_u$ and $n_s=0$ in the two-flavor case and $n_u=n_d=n_s$ in the three-flavor case.
With two flavors we also had $\mu_d = 2^{1/3} \mu_u$,
so the grand potential density \eqref{eq:mit:grand_potential_massless}
yields the pressure $P = -\Omega - B = (1 + 2^{4/3}) \mu_u^4 / 4 \pi^2 - B$ after ``bagging''.
With three flavors we had $\mu_s = \mu_d = \mu_u$ and instead find $P = 3 \mu_u^4 / 4 \pi^2 - B$.
Setting $P=0$, eliminating $\mu_u$ in favor of $B$ and inserting these relations into inequality \eqref{eq:mit:bag_stability},
it becomes exactly solvable and gives the bag window
\begin{equation}
	%\frac{4 B}{(4 \pi^2 B / 3)^\frac34 / \pi^2} < \SI{930}{\mega\electronvolt} < \frac{4 B}{(4 \pi^2 B / (1+2^\frac43))^\frac34 / \pi^2},
	%\quad \text{or} \quad
	\SI{144.4}{\mega\electronvolt} \,\, = \,\,
	\frac{\SI{930}{\mega\electronvolt}}{\Big[4 \pi^2 \!\cdot\! \big(1+2^{4/3}\big)^3\Big]^\frac14}
	\,\, \leq \,\, B^\frac14 \,\, \leq \,\,
	\frac{\SI{930}{\mega\electronvolt}}{\Big[4 \pi^2 \!\cdot\! 3^3\Big]^\frac14}
	\,\, = \,\, \SI{162.8}{\mega\electronvolt}.
\label{eq:mit:bag_window_ur}
\end{equation}

\subsubsection{General bag window}

Returning to the general case with nonzero masses,
the program in \cref{sec:num:qstars2f} solves inequality \eqref{eq:mit:bag_stability} numerically.
It calculates the baryon density $n_B = (n_u+n_d+n_s)/3$
and performs the shift \eqref{eq:mit:bag_shift} of the pressure and energy density for different bag constants $B$
until it finds the one for which the inequality is barely satisfied.
For the two-flavor and three-flavor equations of state in \cref{fig:mit:eos-eos}, the program reports the bag window
\begin{equation}
	\SI{144.3}{\mega\electronvolt} \leq B^\frac14 \leq \SI{154.9}{\mega\electronvolt} .
\label{eq:mit:bag_window}
\end{equation}
Note that whereas inequality \eqref{eq:mit:bag_stability} has three and two flavors on its far left and right,
the \textcolor{blue}{lower} and \textcolor{red}{upper} bounds in all bag windows come from \textcolor{blue}{two} and \textcolor{red}{three} flavors, respectively.
This reverse-ordering of flavors can be understood by noting that $\epsilon \sim B$ and $n_B \sim \mu_u^3 \sim B^{3/4}$, so $\epsilon / n_B \sim B^{1/4}$ on each side of the double inequality \eqref{eq:mit:bag_stability}.
%In all cases, the lower bound comes from the two-flavor equation of state and the upper bound from the three-flavor equation of state.

Also note that the lower bounds in the analytical and numerical bag windows \eqref{eq:mit:bag_window_ur} and \eqref{eq:mit:bag_window}
agree not only with each other, but also with the ``optimal'' bag constant \eqref{eq:mit:bag_constant_optimal}.
In contrast, the upper bounds disagree due to the massless approximation being worse with the addition of the heavy strange quark.


\pagebreak
\section{Quark star solutions}

Different equations of state are now finally available to us by making the shift \eqref{eq:mit:bag_shift}
of the ``unbagged'' equation of state in \cref{fig:mit:eos-eos}
with multiple bag constants inside the established bag window \eqref{eq:mit:bag_window}.
From the numerical implementation in \cref{sec:num:qstars2f},
we then integrate the Tolman-Oppenheimer-Volkoff equation numerically 
by calling upon the program in \cref{sec:nstars:numtov}
as described in \cref{sec:master_intro:tov},
obtaining the quark stars in \cref{fig:mit:mass_radius}:
\begin{figure}[t]
\centering
\tikzsetnextfilename{mit-mass-radius}
\tikzset{
	Bpin/.style={gray, sloped, allow upside down=true, rotate=180, yshift=+0.4cm, font=\small},
}
\begin{tikzpicture}
\begin{groupplot}[
	group style={group size={2 by 1}, vertical sep=0cm, horizontal sep=0.7cm},
	width=8cm, height=8cm,
	xmin=5, xmax=20, ymin=0.5, ymax=2.5, xtick distance=5, ytick distance=0.5, minor tick num=4, grid=major,
	point meta=explicit, point meta min=33, point meta max=36,
	%colorbar horizontal, colormap name=plasmarev, colorbar style={xlabel=$\log_{10} (P_c \, / \, \si{\pascal})$, xtick distance=1, minor x tick num=9, at={(0.5,1.03)}, anchor=south, xticklabel pos=upper},
	/tikz/declare function={
		e0 = 4.266500881855304e+37;
	},
]
\tikzset{
	Bpin/.style={gray, sloped, allow upside down=true, rotate=180, yshift=+0.4cm, font=\small},
}
\nextgroupplot[
	xlabel={$R \, / \, \si{\kilo\meter}$},
	ylabel={$M \, / \, M_\odot$}, %title={Mass-radius diagram for 2-flavor quark stars }, title style={yshift=2.0cm},
	title = {\subcaption{\label{fig:mit:mass_radius_2}Two-flavor MIT bag model quark stars} $B^\frac14 = \{145,150,155\}\,\si{\mega\electronvolt}$}, title style={text width=7.5cm},
];
\addplot+ [solid, mesh] table [x=R, y=M, meta expr={log10(\thisrow{P}*e0)}] {../code/data/MIT2F/stars_sigma_800_B14_145.dat}; % node [Bpin, pos=0.920] {$B = (\SI{27}{\mega\electronvolt})^4$};
\addplot+ [solid, mesh] table [x=R, y=M, meta expr={log10(\thisrow{P}*e0)}] {../code/data/MIT2F/stars_sigma_800_B14_150.dat}; % node [Bpin, pos=0.920] {$B = (\SI{27}{\mega\electronvolt})^4$};
\addplot+ [solid, mesh] table [x=R, y=M, meta expr={log10(\thisrow{P}*e0)}] {../code/data/MIT2F/stars_sigma_800_B14_155.dat}; % node [Bpin, pos=0.920] {$B = (\SI{27}{\mega\electronvolt})^4$};

\nextgroupplot[
	xlabel={$R \, / \, \si{\kilo\meter}$},
	yticklabels={,,},
	title = {\subcaption{\label{fig:mit:mass_radius_3}Three-flavor MIT bag model quark stars} $B^\frac14 = \{145,150,155\}\,\si{\mega\electronvolt}$}, title style={text width=7.5cm},
	colorbar horizontal, colormap name=plasmarev, colorbar style={width=11cm, ylabel=$\log_{10} (P_c \, / \, \si{\pascal})$, ylabel style={rotate=-90}, xtick distance=1, minor x tick num=9, at={(0.87,-0.25)}, anchor=north east, xticklabel pos=lower},
];
\addplot+ [solid, mesh] table [x=R, y=M, meta expr={log10(\thisrow{P}*e0)}] {../code/data/MIT3F/stars_sigma_800_B14_145.dat}; % node [Bpin, pos=0.920] {$B = (\SI{27}{\mega\electronvolt})^4$};
\addplot+ [solid, mesh] table [x=R, y=M, meta expr={log10(\thisrow{P}*e0)}] {../code/data/MIT3F/stars_sigma_800_B14_150.dat}; % node [Bpin, pos=0.920] {$B = (\SI{27}{\mega\electronvolt})^4$};
\addplot+ [solid, mesh] table [x=R, y=M, meta expr={log10(\thisrow{P}*e0)}] {../code/data/MIT3F/stars_sigma_800_B14_155.dat}; % node [Bpin, pos=0.920] {$B = (\SI{27}{\mega\electronvolt})^4$};

\end{groupplot}
\end{tikzpicture}
\caption{\label{fig:mit:mass_radius}%
Mass-radius solutions of the Tolman-Oppenheimer-Volkoff equation \eqref{eq:master_intro:tov} parametrized by the central pressure $P_c$,
using the two-flavor and three-flavor MIT bag model equations of state from \cref{fig:mit:eos-eos}
modified by the bag shift \eqref{eq:mit:bag_shift} with bag constants $B$ covering the bag window \eqref{eq:mit:bag_window}.
Lower bag constants correspond to greater maximum masses.
}
\end{figure}
\begin{itemize}
\item As mentioned in \cref{sec:master_intro:tov} and studied in \cref{sec:nstars:stability},
      stars with central pressure exceeding that of the maximum mass star are unstable against radial perturbations,
      so we cut off the curve not long after the mass peak.
\item The smaller the bag constant, the larger and more massive the star.
      The bag shift \eqref{eq:mit:bag_shift} lifts the equation of state in the $P$-$\epsilon$-diagram up and to the left
      so that a given (energy) density corresponds to a lower pressure.
      This makes the star easier to compress, so we say that the equation of state is \emph{softened}.
      Conversely, an equation of state where a given (energy) density corresponds to a higher pressure
      describes material that is harder to compress and is said to be \emph{stiffer}.
      In other words, lower bag constants yield stiffer equations of state,
      which in turn generate more massive stars,
      so we pay most attention to the lowest $B$ here and onward.

      The increase in size due to the stiffening is easy to understand:
      integrating the Tolman-Oppenheimer-Volkoff equation \eqref{eq:master_intro:tov} from a fixed central pressure $P_c$,
      a stiffer equation of state yields a strictly smaller mass gradient $\odv{m}/{r}$ and pressure gradient magnitude $\abs{\odv{P}/{r}}$,
      so the surface $P(R)=0$ is reached at a greater radius.
      The increase in mass can then only be explained by the effects of the greater radius outweighing those of the smaller mass gradient.
\item Notice the qualitatively similar shapes of mass-radius curves corresponding to different bag constants.
      As mentionde in \cite[equation 8.29]{ref:glendenning},
      it is in fact possible to show that with the bagged ultra-relativistic equation of state $\epsilon = 3P + 4B$,
      the Tolman-Oppenheimer-Volkoff equation \eqref{eq:master_intro:tov} admits scaling solutions
      where the masses $M(B)$ and radii $R(B)$ corresponding to two different bag constants $B=\{B_1,B_2\}$
      are related by $M(B_2) = \sqrt{B_1/B_2} \, M(B_1)$ and $R(B_2) = \sqrt{B_1/B_2} \, R(B_1)$.
      These relations hold only approximately in our massive case.
\item Using bag constants inside the bag window \eqref{eq:mit:bag_window},
      the MIT bag model realizes quark stars with maximum masses
      $1.7 \, M_\odot \leq M \leq 2.0 \, M_\odot$ with $N_f=2$ flavors
      and $1.6 \, M_\odot \leq M \leq 1.9 \, M_\odot$ with $N_f=3$ flavors,
      in both cases with corresponding radii $\SI{9}{\kilo\meter} \leq R \leq \SI{11}{\kilo\meter}$.
      The two-flavor stars are more massive due to their stiffer equation of state in \cref{fig:mit:eos-eos}.
\end{itemize}

\section{Summary}

In this chapter we have reviewed the simplest and most well-known model of quark stars
as a free Fermi gas of deconfined quarks featuring a phenomenological bag constant $B$.
We described a method for determining a window of acceptable bag constants by assuming that at zero pressure,
two-flavor quark matter is unstable and can decay to hadronic matter,
which in turn can decay to three-flavor quark matter
if the strange matter hypothesis of it being the ground state of nuclear matter is true.
By constraining the chemical potentials associated with each particle species,
we saw how to determine the equation of state $\epsilon(P)$,
which in turn was used to integrate the Tolman-Oppenheimer-Volkoff equation \eqref{eq:master_intro:tov},
yielding solutions corresponding to quark stars with given masses and radii.
We obtained maximum masses $1.7 M_\odot \leq M \leq 2.0 M_\odot$ with $N_f=2$ flavors
and $1.6 M_\odot \leq M \leq 1.9 M_\odot$ with $N_f=3$ flavors.
This concludes our introduction to the basic concepts to be used in the remainder of this thesis.
