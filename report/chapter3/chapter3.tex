\chapter{Cold free fermion neutron stars}

\TODO{intro}

\section{Numerical solution of the \texorpdfstring{\\}{}Tolman-Oppenheimer-Volkoff equation}
\label{sec:nstars:numtov}

In \cref{chap:tov}, we derived the Tolman-Oppenheimer-Volkoff equation
\begin{equation}
	\odv{p}{r} = -\frac{G m(r) \epsilon(r)}{r^2 c^2} \left[ 1 + \frac{p(r)}{\epsilon(r)} \right] \left[ 1 + \frac{4 \pi r^3 p(r)}{m(r) c^2} \right] \left[ 1 - \frac{2 G m(r)}{r c^2} \right]^{-1} ,
\label{eq:nstars:tov}
\end{equation}
and
\begin{equation}
	\odv{m}{r} = \frac{4 \pi r^2 \epsilon(r)}{c^2}
\label{eq:nstars:dmdr}
\end{equation}
In \cref{chap:tft}, we found $Z = Z(T, \mu, V)$ for two sample systems.
From $Z$, we could derive $P = P(T, \mu)$ and $\epsilon = \epsilon(T, \mu)$, where the volume $V$ has been eliminated by division, because $P$ and $\epsilon$ are intensive quantities independent of $V$.
At some fixed temperature $T$, we can eliminate $\mu$ to express $\epsilon$ in terms of $P$.
Thus, we can obtain an equation of state
\begin{equation}
	\epsilon = \epsilon(P).
\label{eq:nstars:eos}
\end{equation}
Given the equation of state, we can eliminate $\epsilon$ in terms of $P$ in \cref{eq:nstars:tov,eq:nstars:dmdr} and write the system
\TODO{small $p$ for momentum, big $P$ for pressure everywhere}
\begin{equation}
\begin{split}
	\odv{p(r)}{r} &= -\frac{G m(r) \epsilon(p(r))}{r^2 c^2} \left[ 1 + \frac{p(r)}{\epsilon(p(r))} \right] \left[ 1 + \frac{4 \pi r^3 p(r)}{m(r) c^2} \right] \left[ 1 - \frac{2 G m(r)}{r c^2} \right]^{-1}, \\
	\odv{m(r)}{r} &= \frac{4 \pi r^2 \epsilon(p(r))}{c^2}. \\
\end{split}
\end{equation}
This is a system of two first-order differential equations for $P(r)$ and $m(r)$!
Given a boundary condition, it can be integrated analytically or numerically to obtain $P(r)$ and $m(r)$.
One natural choice of boundary conditions is that, at the center, $m(r) = 0$, while $P(0)$ can be anything.
So we choose the boundary condition
\begin{equation}
	P(0) = P_0
	\quad \text{and} \quad
	m(0) = 0
	\quad \text{at} \quad
	r = 0
\end{equation}
for some $P_0$.
With different values for $P_0$, we essentially parametrize different stars with different pressure and mass profiles $P(r)$ and $m(r)$ at some fixed temperature $T$.
In particular, if $p(R) = 0$ for some $R$, we define $R$ as the radius of the star, and $M = m(R)$ as its mass.

In a few special situations, the TOV system can be solved analytically, like in \cref{sec:incompressible_star}.
More often, however, we must resort to solving the system numerically.
This is straightforward from the system \TODO{ref system}, which is of the form $\odv{\vec{y}}/{t} = \vec{f}(t, \vec{y})$ with $\vec{y} = [P, m]$ and $t = r$ and thus suitable for numerical integration methods like Runge-Kutta methods.
One issue, however, is the scale of variables.
For this purpose, we define the dimensionless quantities
\begin{equation}
	\diml{\epsilon}(r) = \frac{\epsilon(r)}{\epsilon_0}, \quad
	\diml{P}(r) = \frac{P(r)}{\epsilon_0}, \quad
	\diml{m}(r) = \frac{m(r)}{m_0}, \quad
	\diml{r}(r) = \frac{r}{r_0},
\end{equation}
where $m_0$ and $r_0$ are two natural scales of stellar mass and radius, and
\begin{equation}
	\epsilon_0 = \frac{m_0 c^2}{4 \pi r_0^3 / 3}
	%m_0 = \text{solar mass ?}, \quad
	%r_0 = \text{10 km ?}.
\end{equation}
Upon substitution into the TOV system, we get the dimensionless TOV system
\begin{equation}
	\frac{\epsilon_0}{r_0} \odv{\diml{p}}{\diml{r}} = -\frac{G m_0 \epsilon_0}{r_0^2 c^2} \frac{\diml{m} \diml{\epsilon}}{\diml{r}^2} \left[ 1 + \frac{\diml{p}}{\diml{\epsilon}} \right] \left[ 1 + \frac{4 \pi r_0^3 \epsilon_0}{m_0 c^2} \frac{\diml{r}^3 \diml{p}}{\diml{m}} \right] \left[ 1 - \frac{2 G m_0}{r_0 c^2} \frac{\diml{m}}{\diml{r}} \right]^{-1}.
\end{equation}
This can be simplified further.
First, insert the definition of $\epsilon_0$ in the middle parenthesis.
Second, observe that $G_0 = r_0 c^2 / m_0$ has the same units as the gravitational constant $G$, so define the dimensionless gravitational constant $\hat{G} = G / G_0 = G / (r_0 c^2 / m_0)$.
\begin{equation}
	\odv{\diml{p}}{\diml{r}} = - \frac{\diml{G} \diml{m} \diml{\epsilon}}{\diml{r}^2} \left[ 1 + \frac{\diml{p}}{\diml{\epsilon}} \right] \left[ 1 + \frac{3 \diml{r}^3 \diml{p}}{\diml{m}} \right] \left[ 1 - \frac{2 \diml{G} \diml{m}}{\diml{r}} \right]^{-1}.
\end{equation}
Similarly, the dimensionless mass equation becomes
\begin{equation}
	\frac{m_0}{r_0} \odv{\diml{m}(\diml{r})}{\diml{r}} = \frac{4 \pi r_0^2 \epsilon_0}{c^2} \diml{r}^2\diml{\epsilon}(\diml{p}(\diml{r}))
	\quad \text{or} \quad
	\odv{\diml{m}}{\diml{r}} = 3 \diml{r}^2 \diml{\epsilon}
\end{equation}
To summarize, the dimensionless TOV system is
\begin{equation}
\begin{split}
	\odv{\diml{P}}{\diml{r}} &= - \frac{\diml{G} \diml{m} \diml{\epsilon}(\diml{P}(\diml{r}))}{\diml{r}^2} \left[ 1 + \frac{\diml{p}}{\diml{\epsilon}(\diml{P}(\diml{r}))} \right] \left[ 1 + \frac{3 \diml{r}^3 \diml{p}}{\diml{m}} \right] \left[ 1 - \frac{2 \diml{G} \diml{m}}{\diml{r}} \right]^{-1}, \\
	\odv{\diml{m}}{\diml{r}} &= 3 \diml{r}^2 \diml{\epsilon}(\diml{P}(\diml{r})), \\
	\text{subject to } (\diml{P}(0), \diml{m}_0) &= (\diml{P}_0, 0) \text{ at $\diml{r} = 0$}.
\end{split}
\end{equation}

\section{Solution for free Fermi gas neutron star}

Let us use the logarithm of the partition function \eqref{eq:tft:dirac_partition_function} for free Dirac fermions to derive an equation of state inside a neutron star composed of neutrons only.
Then we will solve the TOV equation \eqref{eq:tov} with this equation of state and investigate the mass-radius relation of such neutron stars.

For easy reference, let us repeat the logarithm of the partition function \eqref{eq:tft:dirac_partition_function}.
It is
\begin{equation}
	\log Z = 2 V \int \frac{\dif^3 p}{(2 \pi \hbar)^3} \left\{ \beta E(\vec{p}) + \log \left[ e^{-\beta (E(\vec{p}) - \mu)}+1 \right] + \log \left[ e^{-\beta (E(\vec{p}) + \mu)} + 1\right] \right\}.
\end{equation}
First, the particle number density $n = \thermalavg{N}/V$ follows from the derivative \eqref{eq:tft:average_number} and is
\begin{equation}
	n = 
	\frac{1}{\beta} \pdv{\log Z}{\mu} =
	2 \int \frac{\dif^3 p}{(2 \pi \hbar)^3} \Big\{ n\big[ E(\vec{p})-\mu \big] - n\big[ E(\vec{p})+\mu \big] \Big\} ,
\label{eq:nstars:density}
\end{equation}
where we defined the \textbf{Fermi-Dirac distribution}
\begin{equation}
	n(E) = \frac{1}{e^{-\beta E} + 1}.
\label{eq:nstars:fermi_dirac_distribution}
\end{equation}
The $n$ on the left side of \cref{eq:nstars:density} denotes the particle number density $n = \thermalavg{N}/V$, while $n \left[ E(\vec{p}) \pm \mu \right]$ on the right is the Fermi-Dirac distribution \eqref{eq:nstars:fermi_dirac_distribution} and will \emph{always} be written \emph{with} an argument.
We hope this clearly distinguishes the two and that the naming appears intuitive -- soon we will get rid of $n(E)$, anyway.
From the density \eqref{eq:nstars:density}, we see that $n = n(\mu, T)$ is a function of the chemical potential $\mu$ and temperature $T$, so that at some fixed temperature, the value of $\mu$ decides the particle density $n$.

Second, we calculate the energy density $\epsilon = \thermalavg{N} / V$ from \cref{eq:tft:average_energy}.
It comes out as
\begin{equation}
	\epsilon = 
	\mu n - \frac{1}{V} \pdv{\log Z}{\beta} =
	2 \int \frac{\dif^3 p}{(2 \pi \hbar)^3} \Big\{ -E(\vec{p}) + E(\vec{p}) \, n\big[ E(\vec{p})-\mu \big] + E(\vec{p}) \, n\big[ E(\vec{p})+\mu \big] \Big\}.
\label{eq:nstars:energy_density}
\end{equation}

Third, we find that the pressure \eqref{eq:tft:average_pressure} is
\begin{equation}
	P =
	\frac{\log Z}{\beta V} = 
	2 \int \frac{\dif^3 p}{(2 \pi \hbar)^3} \Big\{ E(\vec{p}) + \log \left[ e^{-\beta(E(\vec{p})-\mu)} + 1 \right] + \log \left[ e^{-\beta(E(\vec{p})+\mu)} + 1 \right] \Big\}.
\label{eq:nstars:pressure}
\end{equation}

The first term of the energy density \eqref{eq:nstars:energy_density} and the pressure \eqref{eq:nstars:pressure} is infinite, as the integrand never decays.
This can be interpreted as an infinite shift of the vacuum energy.
In contrast, the next two terms are finite as the integrand is suppressed for large $\abs{\vec{p}}$ by the Fermi-Dirac distribution.
It makes no sense to include a term that integrates over every possible value of the momentum $\vec{p}$ for physical particles whose momentum cannot exceed a certain value due to energy conservation.
Here, we will make the assumption that we can simply drop this term.
Later, we will return to investigate this term by regularization and renormalization. \TODO{does this make sense?}

From the particle density \eqref{eq:nstars:density} at constant temperature $T$, we see that the sign of $n$ is determined by the sign of $\mu$.
The total density $n$ is expressed as a balance between \emph{particles} with energy $E(\vec{p}) > 0$ living relative to the chemical potential $\mu$ and \emph{antiparticles} with energy $E(\vec{p}) < 0$ living relative to the chemical potential $-\mu$.
Thus, the chemical potential $\mu$ determines the balance between particles and antiparticles in the system.
Similarly, the two last terms in the energy density \eqref{eq:nstars:energy_density} and pressure \eqref{eq:nstars:pressure} can be interpreted as contributions from particles and antiparticles.
We choose a large, positive value of $\mu > 0$, so that the particles dominate the system, while antiparticles are hardly present.
With this choice, $n \left[ E(\vec{p}) - \mu \right] \gg n \left[ E(\vec{p}) + \mu \right]$, and we drop the last term from the particle density \eqref{eq:nstars:density}, energy density \eqref{eq:nstars:energy_density} and pressure \eqref{eq:nstars:pressure}.

We are now left with the 
\begin{equation}
\begin{aligned}
	& \text{particle density} & n        &=  2 \int \frac{\dif^3 p}{(2 \pi \hbar)^3} \, n \left[ E(\vec{p})-\mu \right] , \\
	& \text{energy density}   & \epsilon &=  2 \int \frac{\dif^3 p}{(2 \pi \hbar)^3} \, E(\vec{p}) \, n \left[ E(\vec{p})-\mu \right] \text{ and} \\
	& \text{pressure}         & P        &= -2 \int \frac{\dif^3 p}{(2 \pi \hbar)^3} \, \log \left[ e^{-\beta(E(\vec{p})-\mu)} + 1 \right] . \\
\end{aligned}
\end{equation}
The integrals become nasty after plugging in the dispersion relation $E(\vec{p}) = \sqrt{\vec{p}^2 c^2 + m^2 c^4}$ \TODO{write in display form and refer back to this} and the Fermi-Dirac distribution \eqref{eq:nstars:fermi_dirac_distribution}, and it is overly optimistic to expect that all of them can be evaluated analytically.
We will make one final approximation that will make all the integrals surmountable.

By human standards, it is very hot inside a neutron star.
In fact, studies place typical core temperatures around $T_0 \approx \SI{1e6}{\kelvin}$.
However, neutrons have mass $m \approx \SI{1.67e-27}{\kilogram}$, so everywhere inside a neutron star we have $\beta E(\vec{p}) = \sqrt{\vec{p}^2 c^2 + m^2 c^4} / k_B T > m c^2 / k_B T_0 \approx 10^7 \gg 1$.
Although the temperature is very large compared to everyday temperatures, the thermal energy $k_B T$ is in fact very low relative to the energy $E(\vec{p})$ of the nuclei.
It is therefore an excellent approximation to take the \textbf{zero temperature limit}
\begin{equation}
	\beta E(\vec{p}) \gg 1 .
\end{equation}
In the zero temperature limit,
\begin{equation}
\begin{split}
	n(E)                                 &\rightarrow \theta(-E) = 1 - \theta(E), \\
	\log \left[ e^{-\beta E} + 1 \right] &\rightarrow -\beta E \theta(-E) = -\beta E [1 - \theta(E)]. \\
\end{split}
\end{equation}
as shown in \TODO{make simple figure with converging FD distribution}.
Thus, the zero temperature limit effectively limits the integration to those momenta $\vec{p}$ such that $E(\vec{p}) < \mu$.
We therefore call
\begin{equation}
	\mu = E_F = E(p_F) = \sqrt{p_F^2 c^2 + m^2 c^4}
\end{equation}
the Fermi energy and the corresponding momentum $p_F$ the Fermi momentum, representing the occupied state with highest energy and momentum.

Now the particle density \TODO{ref?} becomes simply
\begin{equation}
	n = 
	2 \int \frac{\dif p \, 4 \pi p^2}{(2 \pi \hbar)^3} \theta \left[ \mu - E(p) \right] =
	2 \int_0^{p_F} \frac{\dif p \, 4 \pi p^2}{(2 \pi \hbar)^3} = \frac{p_F^3}{3 \pi^2 \hbar^3} .
\label{eq:nstars:density_zeroT}
\end{equation}
Using integral \TODO{ref} and defining the dimensionless momentum $x = p / mc$, the energy density is
\begin{equation}
\begin{split}
	\epsilon &=  2 \int \frac{\dif p \, 4 \pi p^2}{(2 \pi \hbar)^3} \, E(p) \, \theta \left[ \mu - E(p) \right] \\
	         &=  2 \int_0^{p_F} \frac{\dif p \, 4 \pi p^2}{(2 \pi \hbar)^3} \, \sqrt{p^2 c^2 + m^2 c^4} \\
	         &= \frac{m^4 c^5}{\pi^2 \hbar^3} \int_0^{x_F} \dif x \, x^2 \sqrt{1 + x^2} \\
	         &= \frac{m^4 c^5}{8 \pi^2 \hbar^3} \left[ \left( 2 x_F^3 + x_F \right) \sqrt{1 + x_F^2} - \asinh x_F \right] . \\
\end{split}
\label{eq:nstars:energy_density_zeroT}
\end{equation}
Finally, using the same integral, the pressure is
\begin{equation}
\begin{split}
	P &= \frac{2}{\beta} \int \frac{\dif p \, 4 \pi p^2}{(2 \pi \hbar)^3} \, \beta \left[ \mu - E(p) \right] \, \theta \left[ \mu - E(p) \right] \\
	  &= 2 \int_0^{p_F} \frac{\dif p \, 4 \pi p^2}{(2 \pi \hbar)^3} \, \left[ \sqrt{p_F^2 c^2 + m^2 c^4} - \sqrt{p^2 c^2 + m^2 c^4} \right] \\
	  &= \frac{m^4 c^5}{\pi^2 \hbar^3} \int_0^{x_F} \dif x \, x^2 \left[ \sqrt{x_F^2+1} - \sqrt{x^2+1} \right] \\
	  &= \frac{m^4 c^5}{24 \pi^2 \hbar^3} \left[ \left( 2 x_F^3 - 3 x_F \right) \sqrt{x_F^2 + 1} + 3 \asinh x_F \right] . \\
\end{split}
\label{eq:nstars:pressure_zeroT}
\end{equation}

The equation of state $\epsilon = \epsilon(P)$ follows by eliminating $x_F$, or equivalently $\mu$.
Due to the complicated dependence of $\epsilon$ and $P$ on $x_F$, we will consider three cases of increasing difficulty.

\subsection{Ultra-relativistic limit}
\label{sec:nstars:ur_limit}

First, consider the ultra-relativistic limit
\begin{equation}
	x_F \gg 1 , 
\label{eq:nstars:ur_limit}
\end{equation}
where the Fermi energy $E_F = \sqrt{p_F^2 c^2 + m^2 c^4} \taylor p_F c$ is dominated by the contribution from the Fermi momentum.
Since $\asinh x_F = \log \left[ x_F + \sqrt{x_F^2 + 1} \right] \taylor \log 2 x_F$ diverges logarithmically, we see that both the energy density and pressure are dominated by the first terms with $2 x_F^3 \sqrt{x_F^2 + 1} \taylor 2 x_F^4$.
Then the energy density and pressure are
\begin{equation}
	\epsilon \taylor \frac{m^4 c^5 x_F^4}{4 \pi^2 \hbar^3}
	\qquad \text{and} \qquad
	P        \taylor \frac{m^4 c^5 x_F^4}{12 \pi^2 \hbar^3},
\end{equation}
and $x_F$ is easily eliminated, yielding the very simple equation of state
\begin{equation}
	\epsilon = 3 P .
\label{eq:nstars:ur_eos}
\end{equation}

In this particular case, the TOV equation \eqref{eq:tov} can be solved analytically with the polynomial trial solution
\begin{equation}
	P(r) = A r^n .
\label{eq:nstars:ur_ansatz}
\end{equation}
Then
\begin{equation}
	\odv{m(r)}{r} = \frac{12 \pi A}{c^2} r^{n+2},
	\qquad \text{so} \qquad
	m(r) = \frac{12 \pi A}{(n+3) c^2} r^{n+3}
	\quad (n \neq -3).
\end{equation}
With the equation of state, $m(r)$ and trial solution, the TOV equation \eqref{eq:tov} reads
\TODO{the 2 in first par wrong?}
\begin{equation}
	n A r^{n-1} =
	-\frac{48 \pi G A^2 r^{2n+1}}{(n+3) c^4} \left[ 2 + \frac{n}{3} \right] \left[ 1 - \frac{24 \pi G A r^{n+2}}{(n+3) c^4} \right]^{-1} .
\end{equation}
We can attain equality for all $r$ if we choose $n = -2$.
Then the rightmost factor no longer depends on $r$, and both sides have the $r^{-3}$-dependence
\begin{equation}
	- 2 A r^{-3} = - \frac{64 \pi G A^2 r^{-3}}{c^4} \left[ 1 - \frac{24 \pi G A}{c^4} \right]^{-1} .
\end{equation}
Then equality is established if we choose $A = c^4 / 56 \pi G$ to match the prefactors.
In conclusion, the pressure and mass is therefore
\begin{equation}
	P(r) = \frac{c^4}{56 \pi G} \frac{1}{r^2}
	\qquad \text{and} \qquad
	m(r) = \frac{3 c^2 r}{14 G}.
\end{equation}
This is a highly unphysical result.
The pressure diverges at the center, so nothing could ever hold such a star together.
In addition, $p(r) > 0$ for all $r$, so the star has no surface and hence infinite mass $M$.
The ultra-relativistic limit \eqref{eq:nstars:ur_limit} is equivalent to a diverging particle density \eqref{eq:nstars:density_zeroT}, so in this regime neutrons stars are as stable as plastic balloons filled with infinite amounts of air.

\subsection{Non-relativistic limit}
\label{sec:nstars:nr_limit}

Next, let us consider the somewhat more difficult non-relativistic limit
\begin{equation}
	x_F \ll 1,
\label{eq:nstars:nr_limit}
\end{equation}
where the Fermi energy $E_F = \sqrt{p_F^2 c^2 + m^2 c^4} \taylor m c^2$ is dominated by the rest energy of the fermions.
Taylor expanding the energy density \eqref{eq:nstars:energy_density_zeroT} and presure \eqref{eq:nstars:pressure_zeroT} around $x_F = 0$ to lowest order, we find
\begin{equation}
	%\epsilon &\taylor \frac{m c^2 p_F^3}{3 \pi^2 \hbar^3} + \frac{p_F^5}{10 \pi^2 \hbar^3 m} = n m c^2 + \frac{p_F^5}{10 \pi^2 \hbar^3 m} \\
	%P        &\taylor \frac{p_F^5}{15 \pi^2 \hbar^3 m}
	\epsilon \taylor \frac{m c^2 p_F^3}{3 \pi^2 \hbar^3}
	\qquad \text{and} \qquad
	P        \taylor \frac{p_F^5}{15 \pi^2 \hbar^3 m} .
\end{equation}
Note that with the density \eqref{eq:nstars:density}, the energy density $\epsilon = n m c^2$ is only due to the rest mass of the particles, as if all fermions have broken free from the Pauli exclusion principle and possess the same rest energy $m c^2$.
This is only a mathematical feature of the non-relativistic limit -- the fermions still occupy different states with different momentum, but the momenta are so small that the differences are negligible compared to the rest energy $mc^2$.
Again, it is straightforward to eliminate $x_F$ to find the equation of state, only this time there is some extra bookkeeping with all the exponents.
Gathering all the prefactors under the same roof, we find
\begin{equation}
	%\epsilon = \frac{mc^2}{3\pi^2\hbar^3} \left( 15 \pi^2 \hbar^3 m P \right)^{3/5}
	\epsilon = \left( \frac{5^3 m^8 c^{10}}{3^2 \pi^4 \hbar^6} \right)^{\frac15}  P^{\frac35} .
\end{equation}
With this power dependence, it is not easy, if even possible, to solve the TOV equation analytically.
The trial solution \eqref{eq:nstars:ur_ansatz} we employed in \cref{sec:nstars:ur_limit} fails miserably, as we do not get the same fortunate cancellations of $r$.
We therefore resort to the numerical solution method described in \cref{sec:nstars:numtov}, parametrizing different stars by their center pressure $P_0$ and integrating the TOV equation until the pressure $p(R)$ vanishes, using the corresponding radius $R$ to establish the mass $M = m(R)$ of the star.

\iffalse
Dimensionless equation of state
\begin{equation}
	\diml{\epsilon} = \left[ \frac{4^2 5^3}{3^4 \pi^2} \frac{m^8 c^6 r_0^6}{m_0^2 \hbar^6} \diml{P}^3 \right]^{\frac{1}{5}}
\end{equation}
\fi

\subsection{General case}

How can we find the energy density
\begin{equation}
	\epsilon = \frac{m^4 c^5}{8 \pi^2 \hbar^3} \left[ \left( 2 x_F^3 + x_F \right) \sqrt{1 + x_F^2} - \asinh x_F \right]
\label{eq:nstars:gr_limit_energy_density}
\end{equation}
that corresponds to a given pressure
\begin{equation}
	P = \frac{m^4 c^5}{24 \pi^2 \hbar^3} \left[ \left( 2 x_F^3 - 3 x_F \right) \sqrt{x_F^2 + 1} + 3 \asinh x_F \right] 
\label{eq:nstars:gr_limit_pressure}
\end{equation}
for general $x_F$?
Since we are already solving the TOV equation on a computer, we can do so by numerical root finding.
At every step $r$ in the numerical integration algorithm, we know the current pressure $P(r)$.
Using a numerical root finding algorithm, we can find the root $x_F$ of the function
\begin{equation}
	f(x_F) = P(x_F) - P(r) = 0,
\end{equation}
where $P(x_F)$ is the pressure \eqref{eq:nstars:gr_limit_pressure} and $P(r)$ is the pressure at the current step.
Then we can simply calculate the corresponding energy density $\epsilon(x_F)$ from \cref{eq:nstars:gr_limit_energy_density}.
This whole procedure can be elegantly encapsulated into a function in the program that takes in $P(r)$ and spits out $\epsilon(P(r))$, effectively implementing an implicit equation of state.

\iffalse
\begin{equation}
	\diml{P}(x_F) = \frac{m^4 c^3 r_0^3}{18 \pi m_0 \hbar^3} \left[ (2 x_F^3 - 3 x_F) \sqrt{x_F^2 + 1} + 3 \asinh x_F \right]
\end{equation}

At every integration step, we have a value of the pressure $P$.
Then find the root $x_F$ of
\begin{equation}
	P(x_F) - P = 0
\end{equation}
and then calculate
\begin{equation}
	\diml{ϵ} = \diml{ϵ}(x_F) = \diml{P}(x_F) = \frac{m^4 c^3 r_0^3}{6 \pi m_0 \hbar^3} \left[ (2 x_F^3 + x_F) \sqrt{x_F^2 + 1} - \asinh x_F \right]
\end{equation}
\fi

\tablemaximum{../code/data/nr.dat}{M}{\maxMnr}
\tablemaximum{../code/data/gr.dat}{M}{\maxMgr}

\begin{figure}
\centering
\begin{tikzpicture}
\begin{axis}[
	width=15cm, height=10cm,
	xlabel=$R / \si{\kilo\meter}$, ylabel=$M / \solarmass$, title={Mass-radius relation for cold free Fermi gas neutron star}, title style={yshift=1.8cm},
	grid=major,
	colorbar horizontal, point meta=explicit, colormap name=plasmarev, colorbar style={xlabel=$\log_{10} (P_0 / \epsilon_0)$, xtick distance=3, minor x tick num=2, at={(0.5,1.03)}, anchor=south, xticklabel pos=upper},
	extra y ticks/.expanded={\maxMnr, \maxMgr}, extra y tick style={dashed}, % https://tex.stackexchange.com/a/333974
]
\addplot [mark=none, mesh, semithick] table [x expr={10*\thisrow{R}}, y=M, meta expr={log10(\thisrow{P})}] {../code/tov_fermi_gas/data/nr.dat} node [pos=0.47, pin={[text=black]0:Non-relativistic limit $p_F \ll 1$}] {};
\addplot [mark=none, mesh, semithick] table [x expr={10*\thisrow{R}}, y=M, meta expr={log10(\thisrow{P})}] {../code/tov_fermi_gas/data/gr.dat} node [pos=0.55, pin={[text=black]-100:Arbitrary $p_F$}] {};

%\edef\doplot{\noexpand\addplot [domain=-10:10, dashed, update limits=false] {\maxM};} % see https://tex.stackexchange.com/a/73916, https://tex.stackexchange.com/a/519
%\doplot

\end{axis}
\end{tikzpicture}

\caption{\label{fig:nstars:massradius}%
	Mass-radius relation for cold neutron stars parametrized by their central pressures $P_0$, obtained by numerically integrating the TOV equation from the central pressure $P_0$ until it vanishes at the surface.
	The numerical integration is carried out using an explicit equation of state in the non-relativistic limit with Fermi momenta $p_F \ll m c$, and using a root-finding algorithm to calculate an implicit equation of state for general $p_F$.
	Non-relativistic stars are parametrized by central pressures $\SI{1e-6}{} \epsilon_0 \le P_0 \le \SI{1e21}{} \epsilon_0$, while stars with arbitrary Fermi momenta are parametrized by $\SI{1e-6}{} \epsilon_0 \le P_0 \le \SI{1e17}{} \epsilon_0$, where $\epsilon_0 = \solarmass c^2 / (4 \pi R_0^3 / 3) = \SI{4.27e34}{\pascal}$, $\solarmass = \SI{1.99e30}{\kilogram}$ is the mass of the sun, $c = \SI{299792458}{\meter\per\second}$ is the speed of light and $R_0 = \SI{10}{\kilo\meter}$.
}

\end{figure}
