\chapter{Ideal neutron stars}
\label{chap:nstars}

In \cref{chap:tft}, we found the partition function $Z = Z(T, \mu, V)$ for two sample systems, and in particular a gas of free Dirac fermions, referred to as an \textbf{ideal Fermi gas}.
From the partition function, we can derive the pressure $P = P(T, \mu)$ and energy density $\epsilon = \Avg{E} / \, V = \epsilon(T, \mu)$ as functions of the temperature and chemical potential using equation \eqref{eq:tft:average_number}, \eqref{eq:tft:average_energy} and \eqref{eq:tft:average_pressure}, eliminating the volume dependence as $P$ and $\epsilon$ are turned into intensive quantities by division.
At some fixed temperature $T$, we can therefore eliminate $\mu$ to express $\epsilon$ in terms of $P$.
This gives us an equation of state $\epsilon = \epsilon(T, P)$ for the energy density.
In this chapter, we will see that inside neutron stars it is valid to consider the zero-temperature limit $T=0$, making the Fermi gas completely degenerate and directly relating pressure to energy density in the resulting temperature-independent equation of state $\epsilon = \epsilon(P)$.
With this equation of state, we can finally solve the Tolman-Oppenheimer-Volkoff system \eqref{eq:tov:tovsys} for some central pressure $P(0)=P_c$.
By doing so for a range of central pressures, we will parametrize a \textbf{mass-radius curve} of \textbf{ideal neutron stars} modeled by degenerate ideal Fermi gases of neutrons.

In the second part of this chapter, we investigate whether the stars on the mass-radius curve we find are \textbf{stable or unstable}.
By applying perturbation theory to the equilibrium analysis of general relativity in \cref{chap:tov}, we will derive a differential equation for radial pulsations of stars slightly outside equilibrium.
We will find a general solution of this equation expressed as a sum over infinitely many normal pulsation modes and corresponding eigenfrequencies, each of which solve a Sturm-Liouville problem.
From this, we will see that we can conclude whether a star is stable or not by checking the \emph{sign} of the eigenvalue of one Sturm-Liouville problem.
To conclude our stability analysis, we therefore use the \textbf{shooting method} to solve a Sturm-Liouville problem for every star on our mass-radius curve to determine their stability.

\textit{This chapter is inspired by references \cite{ref:jensoluf}, \cite{ref:glendenning}, \cite{ref:mtw} and \cite{ref:stability_methods}.}

\section{Equation of state for a degenerate ideal Fermi gas}
\label{sec:nstars:eos}

For ease of reference, the logarithm of the free Dirac fermion partition function \eqref{eq:tft:dirac_partition_function} is
\begin{equation}
	\log Z = 2 V \int \frac{\dif^3 p}{(2 \pi \hbar)^3} \bigg\{ \beta E(\vec{p}) + \log \left[ e^{-\beta (E(\vec{p}) - \mu)}+1 \right] + \log \left[ e^{-\beta (E(\vec{p}) + \mu)} + 1\right] \bigg\},
\end{equation}
and the Fermi-Dirac distribution is
\begin{equation}
	n(E-\mu) = \frac{1}{e^{\beta (E-\mu)} + 1}.
\label{eq:nstars:fermi_dirac_distribution}
\end{equation}

\begin{subequations}
First, the particle number density $n = \Avg{N} / \, V$ follows from the derivative \eqref{eq:tft:average_number} and is
\begin{equation}
	n = 
	\frac{1}{\beta V} \pdv{\log Z}{\mu} =
	2 \int \frac{\dif^3 p}{(2 \pi \hbar)^3} \Big\{ n\big( E(\vec{p})-\mu \big) - n\big( E(\vec{p})+\mu \big) \Big\} .
\label{eq:nstars:density}
\end{equation}
Do not confuse the particle density $n$ on the left with the Fermi-Dirac distributions $n\big(E(\vec{p}) \mp \mu\big)$ on the right!
We will soon perform the integral over $\vec{p}$ and get rid of $n\big(E(\vec{p}) \mp \mu\big)$, anyway.
From the density \eqref{eq:nstars:density}, we see that $n = n(\mu, T)$ is a function of the chemical potential $\mu$ and temperature $T$, so that at some fixed temperature, the value of $\mu$ determines the particle density $n$.

Second, we calculate the energy density $\epsilon = \Avg{E} / \, V$ from \cref{eq:tft:average_energy}.
Inserting the particle number density \eqref{eq:nstars:density} and taking the derivative of $\log Z$, we get
\begin{equation}
	\epsilon = 
	\mu n - \frac{1}{V} \pdv{\log Z}{\beta} =
	2 \int \frac{\dif^3 p}{(2 \pi \hbar)^3} \Big\{ -E(\vec{p}) + E(\vec{p}) \, n\big( E(\vec{p})-\mu \big) + E(\vec{p}) \, n\big( E(\vec{p})+\mu \big) \Big\}.
\label{eq:nstars:energy_density}
\end{equation}

Third, we find that the pressure \eqref{eq:tft:average_pressure} is
\begin{equation}
	P =
	\frac{\log Z}{\beta V} = 
	2 \int \frac{\dif^3 p}{(2 \pi \hbar)^3} \bigg\{ E(\vec{p}) + \frac{1}{\beta} \log \left[ e^{-\beta(E(\vec{p})-\mu)} + 1 \right] + \frac{1}{\beta} \log \left[ e^{-\beta(E(\vec{p})+\mu)} + 1 \right] \bigg\}.
\label{eq:nstars:pressure}
\end{equation}
\end{subequations}
An interpretation of the terms contributing to the particle number density, energy density and pressure is in order.

\begin{enumerate}

\item
From the particle density \eqref{eq:nstars:density} at constant temperature $T$, we see that the sign of $n$ is determined by the sign of $\mu$.
The total density $n$ is expressed as a balance between \emph{particles} living relative to the chemical potential $+\mu$ and \emph{antiparticles} living relative to the chemical potential $-\mu$.
Thus, the chemical potential $\mu$ determines the balance between particles and antiparticles in the system.
Similarly, the two last terms in the energy density \eqref{eq:nstars:energy_density} and pressure \eqref{eq:nstars:pressure} can be interpreted as contributions from particles and antiparticles, respectively.
We \emph{choose} a large positive value of $\mu > 0$, so that the presence of particles dominate, while antiparticles are more or less absent.
With this choice, $n \big( E(\vec{p}) - \mu \big) \gg n \big( E(\vec{p}) + \mu \big)$, and we \emph{drop the last terms of the particle density \eqref{eq:nstars:density}, energy density \eqref{eq:nstars:energy_density} and pressure \eqref{eq:nstars:pressure}}.

\item
The first term of the energy density \eqref{eq:nstars:energy_density} is infinite, as the integrand increases unbounded like $\dif^3 p \, E(\vec{p}) = 4 \pi p^2 \sqrt{p^2 c^2 + m^2 c^4} \propto p^3$ for large $p$.
It is like a sum over the ground state energies of an infinite number of fermionic harmonic oscillators $\hat{H} = \hbar \omega \left( a^\dagger a - \frac{1}{2} \right)$ -- two for spin up and down and two more for both particles and antiparticles.
Therefore, it can be interpreted as an \emph{infinite shift of the vacuum energy}.
We will make the assumption that there is no vacuum energy, or equivalently redefine the infinite contribution as a new zero-point energy.
For example, in the vacuum outside a star there should be no mass density $\rho = \epsilon / c^2$, and hence no energy density $\epsilon$.
Do note, however, that the possible presence of vacuum energy is really an unresolved problem in physics -- we will briefly discuss this in a moment.
Either way, we will \emph{drop the first term of the energy density \eqref{eq:nstars:energy_density}}.
%In contrast, the two last terms are finite as the Fermi-Dirac distribution exponentially suppresses the integrand for large $\Abs{\vec{p}}$.
%It makes no sense to include a term that integrates over every possible value of the momentum $\vec{p}$ for physical particles whose momentum cannot exceed a certain value due to energy conservation.
%We will therefore simply drop the infinite, first terms of the energy density \eqref{eq:nstars:energy_density} and pressure \eqref{eq:nstars:pressure}.
%\TODO{discuss renormalization/regularization/vacuum energy shift/counter terms in outlook?}

\item
Like the energy density, the first term of the pressure \eqref{eq:nstars:pressure} is also infinite.
It is reasonable that if we drop the infinite contribution to the energy density, then we should drop it in the pressure, too.
As we remarked on page \pageref{tft:pressure_renormalization_discussion}, the pressure that we obtain directly from $\log Z$ is really undetermined up to the shift of a constant, anyway, justifying that we do indeed have the freedom to remove such an infinite contribution here as well.
We will therefore \emph{drop the first term of the pressure \eqref{eq:nstars:pressure}}.
Physically, the pressure should vanish when the energy density vanishes.
For example, outside the surface of a star the pressure vanishes by definition, and we assume we are in vacuum with no energy or mass density.
We will see below that dropping the term does indeed ensure that this condition is satisfied.
If you wish, peek ahead and note that both the energy density \eqref{eq:nstars:energy_density_zeroT} and pressure \eqref{eq:nstars:pressure_zeroT} both vanish when $x_F = 0$.

\end{enumerate}

Our ad-hoc removal of the vacuum energy has no doubt sparked the curiosity of the educated reader.
The \emph{cosmological constant problem} is an unresolved problem in physics concerning the disagreement between small \emph{observed} values of the vacuum energy density and large -- here infinite -- values \emph{predicted} by quantum field theory.
The presence of a nonzero vacuum energy density is related to the appearance of the cosmological constant $\Lambda$ in the Einstein field equations.
However, we have used the field equations with $\Lambda = 0$ throughout.
We ``resolve the problem'' by simply discarding the infinite contribution to the vacuum energy density, but make no attempt to conceal the deep theoretical questions underlying this ad-hoc resolution.
For the interested reader, the Wikipedia article \cite{ref:wiki_cosmological_constant_problem} is a good starting point to learn more about the cosmological constant problem.

Before completely losing track of what we were doing, let us get back to calculating the equation of state.
After dropping terms as described above, only the penultimate terms are left in the number density \eqref{eq:nstars:density}, energy density \eqref{eq:nstars:energy_density} and pressure \eqref{eq:nstars:pressure}.
Noting that all integrals only depend on the magnitude $\Abs{\vec{p}} = p$ of the momentum, we rebaptize $E(\vec{p}) = E(p)$ and are left with%
\begin{subequations}%
\begin{align}%
	& \text{particle density} & n        &= 2               \int_0^\infty \frac{\dif p \, 4 \pi p^2}{(2 \pi \hbar)^3} \, n \big( E(p)-\mu \big) , \\
	& \text{energy density}   & \epsilon &= 2               \int_0^\infty \frac{\dif p \, 4 \pi p^2}{(2 \pi \hbar)^3} \, E(p) \, n \big( E(p)-\mu \big) , \\
	& \text{pressure}         & P        &= \frac{2}{\beta} \int_0^\infty \frac{\dif p \, 4 \pi p^2}{(2 \pi \hbar)^3} \, \log \left[ e^{-\beta(E(p)-\mu)} + 1 \right] . 
\end{align}%
\end{subequations}%
The logarithm in the third integral looks annoyingly similar to the Fermi-Dirac distribution in the two first.
Let us make one partial integration on the pressure with $u' = p^2$ and $v = \log \left[ e^{-\beta(E(\vec{p})-\mu)} + 1 \right]$.
The boundary term $u v \propto p^3 \log \left[ e^{-\beta(E(p)-\mu)} + 1 \right]$ then vanishes at $p=0$ because $p^3 = 0$ there, and also at $p = \infty$ where $\log \left[ e^{-\beta(E(p) - \mu)} + 1 \right] = \log \left[ e^{-\infty} + 1 \right] = \log 1 = 0$.
After the partial integration, the three integrals take the satisfyingly similar forms
\begin{subequations}%
\begin{align}%
	& \text{particle density} & n        &= 2 \int_0^\infty \frac{\dif p \, 4 \pi p^2}{(2 \pi \hbar)^3} \, n \big( E(p)-\mu \big) ,          \label{eq:nstars:dropped_infinities_density} \\
	& \text{energy density}   & \epsilon &= 2 \int_0^\infty \frac{\dif p \, 4 \pi p^2}{(2 \pi \hbar)^3} \, E(p) \, n \big( E(p)-\mu \big) ,  \label{eq:nstars:dropped_infinities_energy_density} \\
	& \text{pressure}         & P        &= 2 \int_0^\infty \frac{\dif p \, 4 \pi p^3}{3 (2 \pi \hbar)^3} \, E'(p) \, n \big( E(p)-\mu \big) . \label{eq:nstars:dropped_infinities_pressure}
\end{align}%
\label{eq:nstars:dropped_infinities}%
\end{subequations}%
The integrals become quite complicated after plugging in the relativistic dispersion relation \eqref{eq:tft:dispersion} and the Fermi-Dirac distribution \eqref{eq:nstars:fermi_dirac_distribution}.
In order to calculate them analytically, we will make one more approximation.

At \emph{absolute} zero temperature $T = 0$, the Fermi-Dirac distribution
\begin{equation}
	n(E-\mu) = \frac{1}{e^{\beta (E - \mu)} + 1} = \Theta(\mu-E) = \begin{cases} 0 & (E > \mu) \\ 1 & (E < \mu) \end{cases}
\end{equation}
behaves like a step function.
To see this, observe that $T = 0$ corresponds to $\beta = 1 / k_B T = \infty$, and that the sign of $E - \mu$ then determines whether the exponential $e^{\beta (E - \mu)}$ in the denominator blows up or vanishes, and hence whether the fraction survives.
Physically, this means that the system is completely degenerate, filling momentum states with $E(\vec{p}) < \mu$ only.
The occupied states with the greatest momentum $p_F$ make up a so-called \emph{Fermi surface} $\Abs{\vec{p}} = p_F$ in momentum space, and the corresponding maximum energy $E_F = \sqrt{\smash[b]{p_F^2 c^2 + m^2 c^4}}$ is called the \emph{Fermi energy}, and is equal to the chemical potential when $T = 0$.

Typical neutron star core temperatures linger around $T_0 \approx \SI{1e6}{\kelvin}$, \cite{ref:glendenning} so how is this relevant for our purposes?
In the grand canonical ensemble, the temperature $T$ and chemical potential $\mu$ are formally \emph{independent} variables.
However, we require that the total number of particles $N$, and thus the density $n(\mu, T)$, is \emph{fixed}, so that if we change the temperature, we must also change the chemical potential to compensate.
This creates an implicit dependence between $\mu$ and $T$.
Under this constraint, it is possible to use a Sommerfeld expansion to show mathematically that the chemical potential
\begin{equation}
	\mu(T) = E_F + \bigo \left( \left( \frac{T}{T_F} \right)^2 \right)
\end{equation}
is corrected from the Fermi energy by contributions of second or higher order in $T / T_F$, where $T_F = E_F / k_B$ is the \emph{Fermi temperature}.
For a more detailed discussion of the Sommerfeld expansion and the inter-dependence between $T$ and $\mu$, we recommend \cite[section 3.6]{ref:notes_statistical_physics_tong}.%, \cite[exercise 2]{ref:eth_statistical_physics_exercise}

In other words, if $T \ll T_F$, then $\mu \approx E_F$.
Neutrons have mass $m = \SI{1.67e-27}{\kilogram}$, so the Fermi temperature is at least $T_F = \sqrt{\smash[b]{p_F^2 c^2 + m^2 c^4}} / k_B > m c^2 / k_B \approx \SI{1e13}{\kelvin}$.
Thus, we do indeed have $T / T_F \approx 10^{-7} \ll 1$ for a neutron star.
This is equivalent to $\beta E_F \gg 1$, and since this \emph{implies} that $E_F \approx \mu$, then it is also an excellent approximation to take the \textbf{degenerate limit}
\begin{equation}
	\beta \mu \gg 1 .
\label{eq:nstars:zero_temperature_limit}
\end{equation}
Let us now rewrite the Fermi-Dirac distribution as
\begin{equation}
	n(E-\mu) = \frac{1}{e^{\beta \mu (E/\mu - 1)} + 1} .
\end{equation}
As shown in \cref{fig:nstars:distribution_convergence}, this distribution again resembles the step function $\Theta(\mu - E)$ in the degenerate limit \eqref{eq:nstars:zero_temperature_limit}.
Thus, the zero-temperature behavior of the Fermi-Dirac distribution is restored in this limit.
Although the core temperature is far from zero in everyday terms, it is small \emph{compared to} the Fermi temperature, and this approximation is therefore also referred to as the \textbf{zero-temperature limit}.

In hindsight, since the chemical potential is an independent variable in the partition function, we do have the freedom to simply \emph{assume} the degenerate limit \eqref{eq:nstars:zero_temperature_limit} from the beginning, at the point where we said we \emph{chose} a ``large positive value'' for the chemical potential.

\begin{figure}
	\centering
	\tikzsetnextfilename{fermi-dirac-degenerate}
	\begin{tikzpicture}
	\begin{axis}[
		width=13cm, height=8cm,
		xmin = 0, xmax = 2, xtick distance = 1, ytick distance=0.5, xmajorgrids, ymajorgrids, minor x tick num = 9, minor y tick num = 4,
		title = {Fermi-Dirac distribution towards the degenerate limit},
		xlabel = {$E / \mu$}, ylabel = {$n(E-\mu) = \left[ e^{\beta \mu \left( E / \mu - 1 \right)} + 1 \right]^{-1}$},
		legend cell align = left,
		cycle list/Blues-7,
	]
		\pgfplotsinvokeforeach{5, 10, 20, 40, 80, 160, 320}{
			\addplot+ [thick, domain=0:2, samples=600] {1/(exp((#1 * (x-1))) + 1)};
			\addlegendentry{$\beta \mu = #1 $};
		}
		\filldraw [black] (1, 0.5) circle (2pt);
	\end{axis}
	\end{tikzpicture}
\caption{\label{fig:nstars:distribution_convergence}
	As $\beta \mu \rightarrow \infty$, the Fermi-Dirac distribution $n(E-\mu) = \left[ e^{\beta \mu \left( E / \mu - 1 \right)} + 1 \right]^{-1}$ increasingly resembles the step function $\Theta (\mu - E)$.
}
\end{figure}

\iffalse
In the zero-temperature limit, the Fermi-Dirac distribution can be replaced by
\begin{equation}
	n(E)       =                 \begin{cases} 1 / (e^{+\beta \Abs{E}}+1) & (E>0) \\ 1 / (e^{-\beta \Abs{E}}+1) & (E<0) \end{cases}
	     \quad \rightarrow \quad \begin{cases} 0 & (E>0) \\ 1 & (E<0) \end{cases}
	     \quad =                 \theta(-E) ,
\end{equation}
while the logarithm in the pressure behaves as
\begin{equation}
	\log (e^{-\beta E}+1)       =                 \begin{cases} \log (e^{-\beta \Abs{E}}+1) & (E>0) \\ \log (e^{+\beta \Abs{E}}+1) & (E<0) \end{cases}
	                      \quad \rightarrow \quad \begin{cases} \log 1 & (E>0) \\ \log e^{-\beta E} & (E<0) \end{cases}
	                      \quad =                 -\beta E \, \theta(-E) .
\end{equation}
This is confirmed by the plots in \cref{fig:nstars:distribution_convergence} for increasing values of $\beta$.
Thus, the zero-temperature limit effectively limits the integrals \eqref{eq:nstars:dropped_infinities} to those momenta $\vec{p}$ with $E(\vec{p}) < \mu$.
We therefore call
\begin{equation}
	\mu = E_F = E(p_F) = \sqrt{p_F^2 c^2 + m^2 c^4}
\end{equation}
the Fermi energy and the corresponding momentum $p_F$ the Fermi momentum, representing the occupied state in momentum-space with largest energy and momentum.
\fi

\begin{subequations}
With the zero-temperature approximation, the particle density \eqref{eq:nstars:dropped_infinities_density} is simply
\begin{equation}
	n = 2 \int_0^\infty \frac{\dif p \, 4 \pi p^2}{(2 \pi \hbar)^3} \, \Theta \big( \mu - E(p) \big) \\
	  = 2 \int_0^{p_F} \frac{\dif p \, 4 \pi p^2}{(2 \pi \hbar)^3} \\
	  = \frac{p_F^3}{3 \pi^2 \hbar^3} .
\label{eq:nstars:density_zeroT}
\end{equation}
The energy density \eqref{eq:nstars:dropped_infinities_energy_density} becomes
\begin{equation}
\begin{aligned}
	\epsilon &=  2 \int_0^\infty \frac{\dif p \, 4 \pi p^2}{(2 \pi \hbar)^3} \, E(p) \, \Theta \big( \mu - E(p) \big) \\
	         &=  2 \int_0^{p_F} \frac{\dif p \, 4 \pi p^2}{(2 \pi \hbar)^3} \, \sqrt{p^2 c^2 + m^2 c^4} \\
	         &= \frac{m^4 c^5}{\pi^2 \hbar^3} \int_0^{x_F} \dif x \, x^2 \sqrt{x^2 + 1} && \quad \big( x = p / mc \big) \\
	         %&= \frac{m^4 c^5}{\pi^2 \hbar^3} \left[ \frac{1}{32} \sinh \Big( 4 \asinh x_F \Big) - \frac{1}{8} \asinh x_F \right] . \\
	         &= \frac{m^4 c^5}{8 \pi^2 \hbar^3} \left[ \left( 2 x_F^3 + x_F \right) \sqrt{x_F^2 + 1} - \log \left( x_F + \sqrt{x_F^2 + 1} \right) \right] && \quad \big( \text{by \eqref{eq:integrals:energy_density}} \big) . \\
\end{aligned}
\label{eq:nstars:energy_density_zeroT}
\end{equation}
Finally, the pressure \eqref{eq:nstars:dropped_infinities_pressure} is
\begin{equation}
\begin{aligned}
	P &= 2 \int_0^\infty \frac{\dif p \, 4 \pi p^3}{3 (2 \pi \hbar)^3} \, E'(p) \, \Theta \big( \mu - E(p) \big) \\
	  &= 2 \int_0^{p_F} \frac{\dif p \, 4 \pi p^3}{3 (2 \pi \hbar)^3} \frac{p c^2}{\sqrt{p^2 c^2 + m^2 c^4}} \\
	  &= \frac{m^4 c^5}{3 \pi^2 \hbar^3} \int_0^{x_F} \frac{\dif x \, x^4}{\sqrt{x^2 + 1}} && \quad \big( x = p / mc \big) \\
	  %&= \frac{m^4 c^5}{\pi^2 \hbar^3} \left[ \frac{1}{96} \sinh \Big( 4 \asinh x_F \Big) - \frac{1}{12} \sinh \Big( 2 \asinh x_F \Big) + \frac{1}{8} \asinh x_F \right] . \\
	  &= \frac{m^4 c^5}{24 \pi^2 \hbar^3} \left[ \left( 2 x_F^3 - 3 x_F \right) \sqrt{x_F^2 + 1} + 3 \log \left( x_F + \sqrt{x_F^2 + 1} \right) \right] && \quad \big( \text{by \eqref{eq:integrals:pressure}} \big) .
\end{aligned}
\label{eq:nstars:pressure_zeroT}
\end{equation}
\label{eq:nstars:everything_zeroT}
\end{subequations}

At this point, let us justify the act of dropping the infinite contribution to the pressure \eqref{eq:nstars:pressure}.
Outside a star, for example, we required that the pressure should vanish when the energy density vanishes.
Indeed, now we see that $\epsilon(x_F) = 0$ only if $x_F = 0$, and $P(x_F=0) = 0$.

The equation of state $\epsilon = \epsilon(P)$ follows by eliminating $x_F$ from the energy density \eqref{eq:nstars:energy_density_zeroT} and pressure \eqref{eq:nstars:pressure_zeroT}.
Due to their complicated dependence on $x_F$, we will do so in three cases of increasing difficulty.

\subsection{Ultra-relativistic limit}
\label{sec:nstars:ur_limit}

First, consider the ultra-relativistic limit
\begin{equation}
	x_F \gg 1 , 
\label{eq:nstars:ur_limit}
\end{equation}
where the Fermi energy $E_F = \sqrt{\smash[b]{p_F^2 c^2 + m^2 c^4}} \taylor p_F c$ is dominated by the contribution from the Fermi momentum.
Since $\log \big( x_F + \sqrt{\smash[b]{x_F^2 + 1}} \big) \taylor \log 2 x_F$ diverges only logarithmically, we see that both the energy density \eqref{eq:nstars:energy_density_zeroT} and pressure \eqref{eq:nstars:pressure_zeroT} are dominated by their first terms with $2 x_F^3 \sqrt{\smash[b]{x_F^2 + 1}} \taylor 2 x_F^4$.
In the ultra-relativistic limit, then,
\begin{equation}
	\epsilon \taylor \frac{m^4 c^5 x_F^4}{4 \pi^2 \hbar^3}
	\qquad \text{and} \qquad
	P        \taylor \frac{m^4 c^5 x_F^4}{12 \pi^2 \hbar^3},
\end{equation}
and $x_F$ is easily eliminated, yielding the very simple equation of state
\begin{equation}
	\epsilon = 3 P .
\label{eq:nstars:ur_eos}
\end{equation}

\iffalse
\begin{figure}[ht!]
\centering
\begin{tikzpicture}
\begin{groupplot}[
	group style={group size=2 by 1, horizontal sep=2cm},
	width = 7cm, height = 7cm,
	xtick = \empty, ytick = \empty,
	%ylabel near ticks,
]

\nextgroupplot[
	xlabel = $r$, ylabel = $P(r)$,
	xmin=0, xmax=10, ymin=0, ymax=1,
];
\addplot [thick, domain=0:10, restrict y to domain=0:2, samples=200] {1/x^2};

\nextgroupplot[
	xlabel = $r$, ylabel = $m(r)$,
	xmin=0, xmax=1, ymin=0, ymax=1,
	%yticklabel pos=right,
];
\addplot [thick, domain=0:1, restrict y to domain=0:2, samples=200] {x};

\end{groupplot}
\end{tikzpicture}
\caption{\label{fig:nstars:pressure_mass_ultrarelativistic}%
	With the ultra-relativistic equation of state $\epsilon(P) = 3 P$, the pressure $P(r)$ never vanishes, so a ``star'' has no surface.
	Correspondingly, its mass increases linearly with the radius $r$ and diverges as $r \rightarrow \infty$.
	The scale on the axes are irrelevant.
}
\end{figure}
\fi

\subsection{Non-relativistic limit}
\label{sec:nstars:nr_limit}

Next, let us consider the non-relativistic limit
\begin{equation}
	x_F \ll 1,
\label{eq:nstars:nr_limit}
\end{equation}
where the Fermi energy $E_F = \sqrt{\smash[b]{p_F^2 c^2 + m^2 c^4}} \taylor m c^2$ is dominated by the rest energy of the fermions.
Taylor expanding the energy density \eqref{eq:nstars:energy_density_zeroT} and pressure \eqref{eq:nstars:pressure_zeroT} around $x_F = 0$ to lowest order, we find
\begin{equation}
	%\epsilon &\taylor \frac{m c^2 p_F^3}{3 \pi^2 \hbar^3} + \frac{p_F^5}{10 \pi^2 \hbar^3 m} = n m c^2 + \frac{p_F^5}{10 \pi^2 \hbar^3 m} \\
	%P        &\taylor \frac{p_F^5}{15 \pi^2 \hbar^3 m}
	\epsilon \taylor \frac{m c^2 p_F^3}{3 \pi^2 \hbar^3}
	\qquad \text{and} \qquad
	P        \taylor \frac{p_F^5}{15 \pi^2 \hbar^3 m} .
\end{equation}
Note that with the density \eqref{eq:nstars:density_zeroT}, the energy density can be written $\epsilon = n m c^2$,
as if all fermions have broken free from the Pauli exclusion principle and possess the same energy $mc^2$.
This is only a mathematical feature of the non-relativistic limit -- the fermions still occupy different states with different momentum, but the momenta are so small that the differences are negligible compared to the rest energy $mc^2$.
Again, it is straightforward to eliminate $x_F$ to find the equation of state, only this time there is some extra bookkeeping due to the different exponents of $p_F$.
We find
\begin{equation}
	%\epsilon = \frac{mc^2}{3\pi^2\hbar^3} \left( 15 \pi^2 \hbar^3 m P \right)^{3/5}
	\epsilon = \left( \frac{5^3 m^8 c^{10}}{3^2 \pi^4 \hbar^6} \right)^{\frac15}  P^{\frac35} .
\label{eq:nstars:nr_eos}
\end{equation}

\iffalse
Dimensionless equation of state
\begin{equation}
	\diml{\epsilon} = \left[ \frac{4^2 5^3}{3^4 \pi^2} \frac{m^8 c^6 r_0^6}{m_0^2 \hbar^6} \diml{P}^3 \right]^{\frac{1}{5}}
\end{equation}
\fi

\subsection{General Fermi momenta}
\label{sec:nstars:gr_limit}

How can we find the energy density
\begin{subequations}
\begin{equation}
	\epsilon = \frac{m^4 c^5}{8 \pi^2 \hbar^3} \left[ \left( 2 x_F^3 + x_F \right) \sqrt{x_F^2 + 1} - \log \left( x_F + \sqrt{x_F^2 + 1} \right) \right]
\label{eq:nstars:gr_limit_energy_density}
\end{equation}
that corresponds to a given pressure
\begin{equation}
	P = \frac{m^4 c^5}{24 \pi^2 \hbar^3} \left[ \left( 2 x_F^3 - 3 x_F \right) \sqrt{x_F^2 + 1} + 3 \log \left( x_F + \sqrt{x_F^2 + 1} \right) \right] 
\label{eq:nstars:gr_limit_pressure}%
\end{equation}%
\label{eq:nstars:gr_eos}%
\end{subequations}%
for general $x_F$?
Since we will solve the Tolman-Oppenheimer-Volkoff equations on a computer anyway, we can do so by numerical root finding.
Given the pressure $P$, we use a root finding algorithm to find the root $x_F$ of the function
\begin{equation}
	f(x_F) = P(x_F) - P = 0,
\end{equation}
where $P(x_F)$ is the pressure \eqref{eq:nstars:gr_limit_pressure} as a function of $x_F$.
Having found the root, we can simply calculate the corresponding energy density $\epsilon(x_F)$ from \cref{eq:nstars:gr_limit_energy_density}.
In \cref{sec:num:nstars}, we encapsulate this whole procedure into one numerical equation of state $\epsilon(P)$.

All three equations of state \eqref{eq:nstars:ur_eos}, \eqref{eq:nstars:nr_eos} and \eqref{eq:nstars:gr_eos} are shown in \cref{fig:nstars:eos}.

\iffalse
\begin{equation}
	\diml{P}(x_F) = \frac{m^4 c^3 r_0^3}{18 \pi m_0 \hbar^3} \left[ (2 x_F^3 - 3 x_F) \sqrt{x_F^2 + 1} + 3 \asinh x_F \right]
\end{equation}

At every integration step, we have a value of the pressure $P$.
Then find the root $x_F$ of
\begin{equation}
	P(x_F) - P = 0
\end{equation}
and then calculate
\begin{equation}
	\diml{ϵ} = \diml{ϵ}(x_F) = \diml{P}(x_F) = \frac{m^4 c^3 r_0^3}{6 \pi m_0 \hbar^3} \left[ (2 x_F^3 + x_F) \sqrt{x_F^2 + 1} - \asinh x_F \right]
\end{equation}
\fi

\begin{figure}
\centering
\tikzsetnextfilename{eos}
\begin{tikzpicture}
\pgfplotsset{cycle list/Set1}
\begin{axis}[
	width = 14cm, height=8.0cm,
	xlabel = {$P \, / \, \left[ \solarmass c^2 / (4 \pi R_0^3 / 3) \right]$}, ylabel = {$\epsilon(P) \, / \, \left[ \solarmass c^2 / (4 \pi R_0^3 / 3) \right]$},
	title = {Equations of state for degenerate Fermi gas},
	enlargelimits = false, xmax=20, ymax=100, xmajorgrids, ymajorgrids, minor x tick num=1, minor y tick num=1,
	legend pos = north west,
	legend cell align = left,
	declare function = {
		E(\x) = 2;
	},
	cycle multiindex list = {Set1\nextlist linestyles},
]
\addplot table [x=P, y=epsGR] {../code/data/eos.dat};
\addlegendentry{General $x_F$};
\addplot table [x=P, y=epsNR] {../code/data/eos.dat};
\addlegendentry{Non-relativistic $x_F \ll 1$};
\addplot table [x=P, y=epsUR] {../code/data/eos.dat};
\addlegendentry{Ultra-relativistic $x_F \gg 1$};
\end{axis}
\end{tikzpicture}
\caption{\label{fig:nstars:eos}%
	Equations of state $\epsilon(P)$ for a degenerate Fermi gas for general Fermi momenta $p_F = m c \, x_F$, non-relativistic $p_F \ll mc$ and ultra-relativistic $p_F \gg mc$.
	Here $\solarmass$ is the solar mass and $R_0 = \SI{10}{\kilo\meter}$.
}
\end{figure}

\section{Mass-radius relation for ideal neutron stars}

Having obtained equations of state $\epsilon = \epsilon(P)$, we are finally in a position to solve the Tolman-Oppenheimer-Volkoff system \eqref{eq:tov:tovsys}.
We will do so for all three equations of state that we found in \cref{sec:nstars:eos}.

\subsection{Ultra-relativistic equation of state}

With the ultra-relativistic equation of state \eqref{eq:nstars:ur_eos}, the Tolman-Oppenheimer-Volkoff can be solved analytically with the polynomial trial solution
\begin{equation}
	P(r) = A r^n .
\label{eq:nstars:ur_ansatz}
\end{equation}
With $\epsilon = 3 P = 3 A r^n$, the mass gradient \eqref{eq:tov:tovsys_mass} reads
\begin{equation}
	\odv{m}{r} = \frac{12 \pi A}{c^2} r^{n+2},
	\qquad \text{so} \qquad
	m(r) = \frac{12 \pi A}{(n+3) c^2} r^{n+3}
	\quad (n \neq -3).
\label{eq:nstars:ur_mass}
\end{equation}
Inserting the mass, pressure and energy density into the Tolman-Oppenheimer-Volkoff equation \eqref{eq:tov:tovsys_pressure}, it becomes
\begin{equation}
	n A r^{n-1} =
	-\frac{48 \pi G A^2 r^{2n+1}}{(n+3) c^4} \bigg[ 2 + \frac{n}{3} \bigg] \left[ 1 - \frac{24 \pi G A r^{n+2}}{(n+3) c^4} \right]^{-1} .
\end{equation}
We can attain equality for all $r$ if we choose $n = -2$.
Then the rightmost factor no longer depends on $r$, and both sides have the same $r^{-3}$-dependence
\begin{equation}
	- 2 A r^{-3} = - \frac{64 \pi G A^2 r^{-3}}{c^4} \left[ 1 - \frac{24 \pi G A}{c^4} \right]^{-1} .
\end{equation}
Equality is established if we match the constant factors by choosing $A = c^4 / 56 \pi G$.
Then the solutions for the pressure and mass are
\begin{equation}
	P(r) = \frac{c^4}{56 \pi G r^2}
	\qquad \text{and} \qquad
	m(r) = \frac{3 c^2 r}{14 G} .
\end{equation}
This is a highly unphysical result.
%As shown in \cref{fig:nstars:pressure_mass_ultrarelativistic}, the pressure diverges at the center, so gravity cannot hold such a star together.
The pressure diverges at the center, so gravity cannot hold such a star together.
In addition, $p(r) > 0$ for all $r$, so the star has no surface, and accordingly its mass $M = m(\infty) = \infty$ is infinite.

\subsection{Non-relativistic equation of state}
\label{sec:nstars:nr_limit_solve}

With the power dependence of the non-relativistic equation of state \eqref{eq:nstars:nr_eos}, it is not easy, if even possible, to solve the Tolman-Oppenheimer-Volkoff equation analytically.
The trial solution \eqref{eq:nstars:ur_ansatz} we employed in \cref{sec:nstars:ur_limit} fails miserably, as we do not get the same fortunate cancellations of $r$.
We therefore resort to the numerical solution method described in \cref{sec:nstars:numtov}, parametrizing different stars by their central pressure $P_c$ and integrating the Tolman-Oppenheimer-Volkoff equation until the pressure $p(R)$ vanishes, using the corresponding radius $R$ to establish the mass $M = m(R)$ of the star.
This results in the mass-radius curve shown in \cref{fig:nstars:massradius}.
Notably, the curve peaks at the maximum mass $M = 0.96 \solarmass$ around $R = \SI{8.11}{\kilo\meter}$ when using the full Tolman-Oppenheimer-Volkoff pressure gradient \eqref{eq:tov:tovsys_pressure}, but not when using its Newtonian limit \eqref{eq:weak_field_limit:newtonian_pressure_gradient}.

\subsection{General equation of state}

For general Fermi momenta, the equation of state $\epsilon = \epsilon(P)$ is calculated numerically as described in \cref{sec:nstars:gr_limit}, and the Tolman-Oppenheimer-Volkoff equations are again integrated numerically as described in \cref{sec:nstars:nr_limit_solve}.
The resulting mass-radius curve is also shown in \cref{fig:nstars:massradius}.
Again, the curve peaks at a maximum mass $M = 0.71 \solarmass$ only for the relativistic pressure gradient.
This is the most accurate equation of state, and it is therefore the bottom curve in \cref{fig:nstars:massradius} that we should pay most attention to.
In addition, we show the pressure profiles for some stars on this curve in \cref{fig:nstars:pressure_profiles}.
Notice that the normalized profiles are quite similar for central pressures below that corresponding to the maximum mass, but begin to change dramatically once it is exceeded!

\tablemaximum{../code/data/nr.dat}{M}{\maxMnr}{R}{\maxRnr}
\pgfmathparse{10*\maxRnr}
\pgfmathsetmacro{\maxRnr}{\pgfmathresult}
\tablemaximum{../code/data/gr.dat}{M}{\maxMgr}{R}{\maxRgr}
\pgfmathparse{10*\maxRgr}
\pgfmathsetmacro{\maxRgr}{\pgfmathresult}

\begin{figure}
\centering
\tikzsetnextfilename{mass-radius}
\begin{tikzpicture}[
	every pin edge/.style={draw=black, latex-, thin},
	every pin/.style={text=black, font=\small},
	every node/.style={text=black, font=\small},
]
\begin{axis}[
	width=15cm, height=15cm,
	xlabel=$R / \si{\kilo\meter}$, ylabel=$M / \solarmass$, title={Mass-radius diagram for ideal neutron stars}, title style={yshift=2.3cm},
	xmin=0, xmax=50, xtick distance=5, minor x tick num=4,
	ymin=0, ymax=1.1, ytick distance=0.1, minor y tick num=9,
	grid=major,
	colorbar horizontal, point meta=explicit, colormap name=plasmarev, colorbar style={xlabel=$\log_{10} (P_c / \si{\pascal})$, xtick distance=1, minor x tick num=0, at={(0.5,1.03)}, anchor=south, xticklabel pos=upper},
	point meta min=28, point meta max=42,
	declare function={
		e0 = 4.266500881855305e+34;
	},
	%extra y ticks/.expanded={\maxMnr, \maxMgr}, extra y tick style={dashed}, % https://tex.stackexchange.com/a/333974
	%extra x ticks/.expanded={{10*\maxRnr}, {10*\maxRgr}}, extra x tick style={dashed, tick label style={yshift=-1ex}},
]
\addplot+ [mesh] table [x expr={10*\thisrow{R}}, y=M, meta expr={log10(\thisrow{P} * e0)}] {../code/data/gr.dat} node [pos=0.720, pin={[latex-, xshift=4.15em, ]0:relativistic $\odv{P}/{r}$, general $\epsilon(P)$}] {};
\addplot+ [mesh] table [x expr={10*\thisrow{R}}, y=M, meta expr={log10(\thisrow{P} * e0)}] {../code/data/nr.dat} node [pos=0.720, pin={[latex-, xshift=3.8em, ]0:relativistic $\odv{P}/{r}$, non-relativistic $\epsilon(P)$}] {};
\addplot+ [mesh] table [x expr={10*\thisrow{R}}, y=M, meta expr={log10(\thisrow{P} * e0)}] {../code/data/grnewt.dat} node [pos=0.840, pin={[latex-, xshift=3.25em, ]0:Newtonian $\odv{P}/{r}$, general $\epsilon(P)$}] {};
\addplot+ [mesh] table [x expr={10*\thisrow{R}}, y=M, meta expr={log10(\thisrow{P} * e0)}] {../code/data/nrnewt.dat} node [pos=0.845, pin={[latex-, xshift=2.75em, ]0:Newtonian $\odv{P}/{r}$, non-relativistic $\epsilon(P)$}] {};
\node [circle, fill, inner sep=1pt, label={[xshift=+0.2ex, yshift=-1.3ex]+90:{$\begin{aligned} R &= \pgfmathprintnumber\maxRnr \, \si{\kilo\meter} \\ M &= \pgfmathprintnumber\maxMnr \, \solarmass \\ P_c &= \SI{1e35}{\pascal}\end{aligned}$}}] (maxnr) at (\maxRnr, \maxMnr) {};
\node [circle, fill, inner sep=1pt, pin  ={[xshift=+2.0ex, yshift=-5.0ex]-90:{$\begin{aligned} R &= \pgfmathprintnumber\maxRgr \, \si{\kilo\meter} \\ M &= \pgfmathprintnumber\maxMgr \, \solarmass \\ P_c &= \SI{4e34}{\pascal}\end{aligned}$}}] (maxnr) at (\maxRgr, \maxMgr) {};
%\node [above=of maxnr, anchor=south, xshift= 0em, yshift=-3em, align=center] (maxnrlabel) {\small$\begin{aligned} R &= \pgfmathprintnumber\maxRnr \, \si{\kilo\meter} \\ M &= \pgfmathprintnumber\maxMnr \, \solarmass \\ P_c &= \SI{1e35}{\pascal}\end{aligned}$};
%\node [below=of maxgr, anchor=north, xshift=+1em, yshift=-1em, align=center] (maxgrlabel) {\small$\begin{aligned} R &= \pgfmathprintnumber\maxRgr \, \si{\kilo\meter} \\ M &= \pgfmathprintnumber\maxMgr \, \solarmass \\ P_c &= \SI{4e34}{\pascal}\end{aligned}$};
%\draw [-latex, very thick] (maxgrlabel) -- (maxgr);
%\node [] (maxgr) at (\maxRgr, \maxMgr) {};
%\node [circle, fill, inner sep=1pt, label={90:$(\pgfmathprintnumber\maxRnr, \pgfmathprintnumber\maxMnr)$}] at ({\maxRnr}, \maxMnr) {};
%\node [circle, fill, inner sep=1pt, label={90:$(\pgfmathprintnumber\maxRgr, \pgfmathprintnumber\maxMgr)$}] at ({\maxRgr}, \maxMgr) {};
%\node [circle, fill, inner sep=1pt, pin={[]0:$(\pgfmathprintnumber\maxRnr, \pgfmathprintnumber\maxMnr)$}] at ({\maxRnr}, \maxMnr) {};
%\node [circle, fill, inner sep=1pt, pin={[]0:$(\pgfmathprintnumber\maxRgr, \pgfmathprintnumber\maxMgr)$}] at ({\maxRgr}, \maxMgr) {};

%\edef\doplot{\noexpand\addplot [domain=-10:10, dashed, update limits=false] {\maxM};} % see https://tex.stackexchange.com/a/73916, https://tex.stackexchange.com/a/519
%\doplot
\end{axis}
\end{tikzpicture}

\caption{\label{fig:nstars:massradius}%
Mass-radius curve for ideal neutron stars parametrized by their central pressure $P_c$. 
The curve is obtained by numerically integrating the Tolman-Oppenheimer-Volkoff equations \eqref{eq:tov:tovsys} with both the relativistic pressure gradient \eqref{eq:tov:tovsys_pressure} (``relativistic $\odv{P}/{r}$'') and its Newtonian limit \eqref{eq:weak_field_limit:newtonian_pressure_gradient} (``Newtonian $\odv{P}/{r}$'') from the center $r=0$ with pressure $P(0) = P_c$ until the pressure $P(r)=0$ vanishes at the surface $r=R$.
The numerical integration is carried out using both the explicit non-relativistic equation of state \eqref{eq:nstars:nr_eos} (``non-relativistic $\epsilon(P)$''), and using a root-finding algorithm to calculate the general equation of state \eqref{eq:nstars:gr_eos} (``general $\epsilon(P)$'').
Consult \cref{chap:code} for the implementation of the computer program.
Stars are parametrized by central pressures $\SI{4.27e28}{\pascal} \le P_c \le \SI{4.27e41}{\pascal}$, and $\solarmass$ is the mass of the sun.
}
\end{figure}

\begin{figure}
\centering
\tikzsetnextfilename{neutron-star-pressures}
\begin{tikzpicture}[
	every pin edge/.style={draw=black, latex-, thin},
	every pin/.style={text=black, font=\small},
	every node/.style={text=black, font=\small},
]
\begin{axis}[
	width=15cm, height=14cm,
	xlabel=$r / R$, ylabel=$P(r) / P(0)$, title={Pressure profiles for ideal neutron stars}, title style={yshift=2.3cm},
	xmin=0, xmax=1, xtick distance=0.1, minor x tick num=9,
	ymin=0, ymax=1, ytick distance=0.1, minor y tick num=9,
	grid=major,
	colorbar horizontal, point meta=explicit, colormap name=plasmarev, colorbar style={xlabel=$\log_{10} (P_c / \si{\pascal})$, xtick distance=1, minor x tick num=0, at={(0.5,1.03)}, anchor=south, xticklabel pos=upper},
	point meta min=28, point meta max=42,
	declare function={
		e0 = 4.266500881855305e+34;
	},
]
\pgfplotstableread{../code/data/pressures.dat}{\pressuretable}
\pgfplotsinvokeforeach{0,...,13}{
	\pgfplotstablegetelem{#1}{P0}\of{\pressuretable}
	\edef\temp{\noexpand\addplot+ [solid, mesh] table [x={x#1}, y={p#1}, meta expr={log10(e0 * \pgfplotsretval)}] {../code/data/pressures.dat};}
	\temp
}

\pgfplotstablegetelem{0}{P0}\of{\pressuretable}
\edef\temp{\noexpand\addplot [draw=none] table [x={x0}, y={p0}] {../code/data/pressures.dat} node [pos=0.42, sloped, yshift=+0.6em] {$P_c = \SI{4.27e28}{\pascal}$};}
\temp
\pgfplotstablegetelem{6}{P0}\of{\pressuretable}
\edef\temp{\noexpand\addplot [draw=none] table [x={x6}, y={p6}] {../code/data/pressures.dat} node [pos=0.42, sloped, yshift=+0.6em] {$P_c = \SI{4.27e34}{\pascal}$};}
\temp
\pgfplotstablegetelem{7}{P0}\of{\pressuretable}
\edef\temp{\noexpand\addplot [draw=none] table [x={x7}, y={p7}] {../code/data/pressures.dat} node [pos=0.42, sloped, yshift=+0.6em] {$P_c = \SI{4.27e35}{\pascal}$};}
\temp
\pgfplotstablegetelem{8}{P0}\of{\pressuretable}
\edef\temp{\noexpand\addplot [draw=none] table [x={x8}, y={p8}] {../code/data/pressures.dat} node [pos=0.42, sloped, yshift=+0.6em] {$P_c = \SI{4.27e36}{\pascal}$};}
\temp
\pgfplotstablegetelem{9}{P0}\of{\pressuretable}
\edef\temp{\noexpand\addplot [draw=none] table [x={x9}, y={p9}] {../code/data/pressures.dat} node [pos=0.42, sloped, yshift=+0.6em] {$P_c = \SI{4.27e37}{\pascal}$};}
\temp
\pgfplotstablegetelem{10}{P0}\of{\pressuretable}
\edef\temp{\noexpand\addplot [draw=none] table [x={x10}, y={p10}] {../code/data/pressures.dat} node [pos=0.42, sloped, yshift=+0.6em] {$P_c = \SI{4.27e38}{\pascal}$};}
\temp

\end{axis}
\end{tikzpicture}
\caption{\label{fig:nstars:pressure_profiles}%
	Normalized pressure profiles $P(r) / P(0)$ for the $14$ neutron stars with central pressures $P_c = P(0) = \SI{4.27e28}{\pascal},\, \SI{4.27e29}{\pascal},\, \ldots,\, \SI{4.27e41}{\pascal}$ along the bottom sequence in \cref{fig:nstars:massradius}.
	Where there is sufficient space, the central pressure is written above the pressure profile of the star it corresponds to.
}
\end{figure}

\section{Stability analysis}

The mass-radius curves in \cref{fig:nstars:massradius} display some interesting behavior.
In particular, the curves obtained with the relativistic pressure gradient enter spirals for central pressures greater than those corresponding to their maximum masses.
As we derived the Tolman-Oppenheimer-Volkoff equations, we assumed the star to be in hydrostatic equilibrium.
Our use of statistical mechanics in the grand canonical ensemble to obtain the equation of state is consistent with this, as it describes a system in thermal and chemical equilibrium.
So all stars on the mass-radius curve are in \emph{equilibrium}, but just like a pendulum can be in a stable or unstable equilibrium, the equilibrium state of a star can also be either \emph{stable} or \emph{unstable} with respect to small perturbations.
Let us investigate the stability of the sequences of stars in \cref{fig:nstars:massradius}.

\subsection{Necessary conditions for stability}
\label{sec:nstars:stability_necessary}

We will start by presenting a few \emph{necessary} conditions for stability from simple physical considerations.
However, neither of the conditions are \emph{sufficient} for a star to be stable, so we can only use them to identify unstable stars.

\subsubsection{The Buchdal limit}

We have already discussed one such condition -- the Buchdal limit \eqref{eq:incompressible_star:buchdal}.
In fact, we have plotted the line $M = 4 c^2 R / 9 G$ in \cref{fig:nstars:massradius} -- it is just so steep that it coincides with the vertical axis and is completely invisible.
Only stars above this line would be unstable, and it therefore does not rule out any stars on our mass-radius curve.

\subsubsection{Causality}

However exotic life inside a star may be, it cannot break causality. 
In particular, the speed of sound $v = \sqrt{\odv{P}/{\rho}} = c \, \sqrt{\odv{P}/{\epsilon}}$, as derived in \cref{sec:relfluid:sound}, should not exceed the speed of light $c$.
The equation of state $\epsilon = \epsilon(P)$ must therefore satisfy
\begin{equation}
	\odv{P}{\epsilon} < 1
	\qquad \text{(necessary condition)} .
\end{equation}
How does the equation of state for a free Fermi gas hold up in this regard?
Recall that the equation of state for general Fermi momenta $p_F$ followed by eliminating $x_F$ from the energy density \eqref{eq:nstars:energy_density_zeroT} to express it in terms of the pressure \eqref{eq:nstars:pressure_zeroT}.
It is straightforward to calculate the derivatives
\begin{equation}
	\odv{P}{x_F} = \frac{m^4 c^5}{3 \pi^2 \hbar^3} \frac{x_F^4}{\sqrt{x_F^2 + 1}}
	\quad \text{and} \quad
	\odv{\epsilon}{x_F} = \frac{m^4 c^5}{\pi^2 \hbar^3} x_F^2 \, \sqrt{x_F^2 + 1} .
\end{equation}
Then we can apply the chain rule and the rule of inverse derivatives to obtain
\begin{equation}
	\odv{P}{\epsilon} = 
	\odv{P}{x_F} \odv{x_F}{\epsilon} =
	\frac{\odv{P}/{x_F}}{\odv{\epsilon}/{x_F}} =
	\frac13 \, \frac{1}{1+1/x_F^2}.
\label{eq:nstars:dPde}
\end{equation}
We see that $\odv{P}/{\epsilon} < 1$ for all $x_F$ and approaches $1/3$ in the ultra-relativistic limit $x_F \rightarrow \infty$, as we should expect from the corresponding equation of state \eqref{eq:nstars:ur_eos}.
Alternatively, this can be seen by inspecting the slopes $\odv{\epsilon}/{P} > 1$ of the equations of state in \cref{fig:nstars:eos}.
Hence, all the stars in \cref{fig:nstars:massradius} satisfy this condition, so it does not rule out any of them.

\begin{figure}
\tikzsetnextfilename{star-explosion}
\begin{tikzpicture}
\newcommand\drawstarforcebalance[8]{
	\draw [very thick, inner color=yellow!#6!gray, outer color=red!#6!gray] (#1,#2) circle [radius=#3];
	\draw [thick] [-{Latex[width=#7mm,length=#7mm]}] ({#1-0.1},{#2+0.1}) -- ({#1-0.1+#4*cos(45)},{#2+0.1+#4*sin(45)});
	\draw [thick] [{Latex[width=#8mm,length=#8mm]}-] ({#1+0.1},{#2-0.1}) -- ({#1+0.1+#5*cos(45)},{#2-0.1+#5*sin(45)});
}
\drawstarforcebalance{0.0}{0.0}{1.0}{0.9}{0.9}{0}{4}{4};
\drawstarforcebalance{3.0}{0.0}{1.5}{1.4}{0.7}{33}{5}{3};
\drawstarforcebalance{7.0}{0.0}{2.0}{1.9}{0.5}{66}{6}{2};
\node[starburst, fill=yellow, draw=red, line width=2pt, anchor=west, minimum size=5cm] at (10,0) {\huge\textbf{BOOM}};
\end{tikzpicture}
\caption{\label{fig:nstars:star_explosion}%
A slight decrease $\dif \epsilon < 0$ in energy density weakens the gravitational force pulling a star in.
If the equation of state $\epsilon = \epsilon(P)$ in a star satisfies $\odv{P}/{\epsilon} < 0$, such a change in energy density would cause an increase $\dif P > 0$ in the pressure pushing the star out.
The greater pressure then causes the star to expand, which in turn causes another decrease in energy density.
Repeated application of the same argument shows that the star continues to expand while the pressure grows indefinitely, so the star ultimately explodes.
}
\end{figure}

\subsubsection{Real speed of sound}

From the expression $v = c \sqrt{\odv{P}/{\epsilon}}$ of the speed of sound, it also seems reasonable to require that
\begin{equation}
	\odv{P}{\epsilon} > 0
	\qquad \text{(necessary condition)}
\label{eq:nstars:stability_pressure_energy_density}
\end{equation}
for it to be a real quantity.
Violation of this condition would in fact have dramatic consequences.
First, note that an increase in energy density $\dif \epsilon > 0$ is \emph{always} accompanied by an increase in the gravitational force attempting to pull the star inwards.
If such an increase implied a \emph{decrease} $\dif P < 0$ in the pressure that pushes the star outwards, then the gravitational force would automatically ``win'', causing the star to contract, and hence the energy density to increase further.
Repeating the argument, we understand that the star collapses.
This process is illustrated in \cref{fig:nstars:star_explosion}.
Likewise, if a decrease $\dif \epsilon < 0$ caused an increase $\dif P > 0$, the same argument shows that the pressure wins and the star explodes.
However, if the changes $\dif \epsilon$ and $\dif P$ are of the same sign, then the pressure and gravitational force will at the very least counteract each other instead of driving apart.
In this case the star \emph{can} be stable, but the precise balance between the forces would have to be investigated in detail to conclude if it \emph{really is}.
In our case, the derivative \eqref{eq:nstars:dPde} is already positive, so this criterion does not let us rule out any of our stars, either.
However, this result is not completely useless, as it will be useful to assert that condition \eqref{eq:nstars:stability_pressure_energy_density} is satisfied as we continue our stability analysis.

\begin{figure}
\centering
\tikzsetnextfilename{stability-mass-epsilon0}
\begin{tikzpicture}
%\begin{axis}[axis x line=bottom, axis y line=left, xlabel=$P_c$, ylabel=$M$, xtick=\empty, ytick=\empty]
\begin{axis}[axis x line=bottom, axis y line=left, axis line style={very thick, -Latex[]}, xlabel=$P_c$, ylabel=$M$, xtick=\empty, ytick=\empty, xmax=1.15, ymax=0.1]
	\addplot[thick, domain=-1:0, Greens-J, smooth] {-x^2};
	\addplot[thick, domain=0:+1, Reds-J,   smooth] {-x^2};

	\node (E1inc) [draw=black, circle, fill, inner sep=1pt, label=left:$E_1^+$] at (axis cs:-0.7,-0.49) {};
	\node (E2inc) [draw=black, circle, fill, inner sep=1pt, label=left:$E_2^+$] at (axis cs:-0.5,-0.25) {};
	\node  (Cinc) [draw=black, circle, fill, inner sep=1pt, label=right:$C^+$ ] at (axis cs:-0.5,-0.49) {};

	\node (E1dec) [draw=black, circle, fill, inner sep=1pt, label=left:$E_2^-$] at (axis cs:+0.7,-0.49) {};
	\node (E2dec) [draw=black, circle, fill, inner sep=1pt, label=left:$E_1^-$] at (axis cs:+0.5,-0.25) {};
	\node  (Cdec) [draw=black, circle, fill, inner sep=1pt, label=right:$C^-$ ] at (axis cs:+0.7,-0.25) {};

	\draw [dashed] (E1inc) -- (Cinc) -- (E2inc);
	\draw [dashed] (E1dec) -- (Cdec) -- (E2dec);
\end{axis}
\end{tikzpicture}
\caption{\label{fig:nstars:stability_mass_pressure}%
	Suppose an equilibrium star $E_1^+$ on an \emph{increasing} part of the mass-pressure curve $M(P_c)$ is compressed to a non-equilibrium star $C^+$ with the same mass.
	Compared to the \emph{more massive} equilibrium star $E_2^+$ with the increased central pressure, it experiences \emph{less} gravitational attraction, causing it to expand back towards the original equilibrium configuration $E_1^+$.
	In contrast, suppose an equilibrium star $E_1^-$ on a \emph{decreasing} part of the mass-pressure curve is compressed to a non-equilibrium star $C_-$ with the same mass.
	Compared to the \emph{less massive} equilibrium star $E_2^-$ with the increased central pressure, it experiences \emph{more} gravitational attraction, causing it to compress even more and ultimately implode.
}
\end{figure}

\subsubsection{Mass increase for rising central pressure}

A fourth necessary condition for stars parametrized by their central pressure $P_c$ is
\begin{equation}
	\odv{M(P_c)}{P_c} > 0
	\qquad \text{(necessary condition)} .
\label{eq:nstars:stability_mass_pressure}
\end{equation}
To understand it, consider a star $E_1^+$ in equilibrium on the increasing part of the mass-pressure curve in \cref{fig:nstars:stability_mass_pressure}, where condition \eqref{eq:nstars:stability_mass_pressure} is satisfied.
Now compress this star to the non-equilibrium star $C^+$ with the same mass, and let $E_2^+$ be the star in equilibrium with the same central pressure as $C^+$.
Then $C^+$ has less mass than $E_2^+$, and hence \emph{weaker gravitational forces} but the \emph{same central pressure} as $E_2^+$.
As a result, $C^+$ will expand and hence relieve the central pressure, causing it to return towards the equilibrium star $E_1^+$.

Let us repeat the argument on the decreasing part of the curve, where condition \eqref{eq:nstars:stability_mass_pressure} does not hold.
After compressing $E_1^-$ to $C^-$, we see that $C^-$ has more mass, and hence \emph{stronger gravitational forces} but the \emph{same central pressure} as $E_2^-$.
As a result, $C^+$ contracts, and repeating the argument then shows that it drifts away from the equilibrium curve in \cref{fig:nstars:stability_mass_pressure} and collapses.

Criterion \eqref{eq:nstars:stability_mass_pressure} shows that the stars located between the maximum mass and the bottom of the spiral in \cref{fig:nstars:massradius} are unstable!
Moreover, it suggests that there is a change in character of stability across a stationary point $\odv{M(P_c)}/{P_c} = 0$ on the mass-radius curve.
We will now investigate this further.

\subsection{General analysis of stability}
\label{sec:nstars:stability_general}

The arguments presented above were necessary, but not sufficient for stellar stability.
Let us analyze the stability of the stars in a more rigorous way by finding a necessary \emph{and} sufficient criterion for stability.
We will follow the path of Chandrasekhar \cite{ref:chandrasekhar_stability} and \cite[§26]{ref:mtw}.

\subsubsection{Perturbation theory for the fluid displacement}

In \cref{sec:einstein_to_tov}, we showed that in the spherically symmetric metric
\begin{equation}
	\dif s^2 = e^{2 \alpha_0(r)} c^2 \dif t^2 - e^{2 \beta_0(r)} \dif r^2 - r^2 \left( \dif \theta^2 + \sin^2 \theta \dif \phi^2 \right) ,
\end{equation}
for a perfect fluid with energy-momentum
\begin{equation}
	T_{\mu \nu} = \frac{1}{c^2} u_\mu u_\nu (\epsilon_0 + P_0) - g_{\mu \nu} P_0
	\qquad \text{where} \qquad
	P_0 = P_0(r) \text{ and } \epsilon_0 = \epsilon_0(r)
\label{eq:nstars:energy_momentum}
\end{equation}
that is in \emph{equilibrium} with four-velocity
\begin{equation}
	u^\mu = (u^0, 0, 0, 0) ,
\label{eq:nstars:velocity_equilibrium}
\end{equation}
the Einstein field equations \eqref{eq:einstein} reduce to
\begin{subequations}%
\begin{align}%
	\frac{1}{r^2} e^{-2 \beta_0} \left( 2 r \beta_0' - 1 + e^{2 \beta_0} \right)  &= \frac{8 \pi G}{c^4} \epsilon_0   && \bigg( G_{00} = \frac{8 \pi G}{c^4} T_{00} \bigg) , \label{eq:nstars:field_equations_equilibrium_00} \\
	\frac{1}{r^2} e^{-2 \beta_0} \left( 2 r \alpha_0' + 1 - e^{2 \beta_0} \right) &= \frac{8 \pi G}{c^4} P_0          && \bigg( G_{11} = \frac{8 \pi G}{c^4} T_{11} \bigg) , \label{eq:nstars:field_equations_equilibrium_11} \\
	\alpha_0'                                                                     &= \frac{-1}{\epsilon_0 + P_0} P_0' && \bigg( \nabla_\mu T\indices{^\mu_1} = 0 \bigg)    , \label{eq:nstars:field_equations_equilibrium_T}
	%e^{-2 \beta_0} \left( \alpha_0'' + (\alpha_0')^2 - \alpha_0' \beta_0' + \frac{1}{r} (\alpha_0' - \beta_0') \right) &= \frac{8 \pi G}{c^4} P_0,
\end{align}%
\label{eq:nstars:field_equations_equilibrium}%
\end{subequations}%
where $' = \pdv{}/{r}$.

Now we suppose that the fluid is no longer in equilibrium, but rather allow for a small radial velocity component $u^1$ in the four-velocity
\begin{equation}
	u^\mu = (u^0, u^1, 0, 0) .
	\quad
\label{eq:nstars:velocity_unstable}
\end{equation}
By the spherical symmetry, we still assume that there is only radial motion of fluid elements.
In a rotating neutron star -- a pulsar -- for example, the situation would be more complicated.
The metric should therefore still be spherically symmetric, but $\alpha_0(r) \rightarrow \alpha(r,t)$ and $\beta_0(r) \rightarrow \beta(r,t)$ are now promoted to time-dependent functions, and therefore so are the pressure $P_0(r) \rightarrow P(r,t)$ and energy density $\epsilon_0(r) \rightarrow \epsilon(r,t)$.
We therefore have the new metric
\begin{equation}
	\dif s^2 = e^{2 \alpha(t, r)} c^2 \dif t^2 - e^{2 \beta(t, r)} \dif r^2 - r^2 \left( \dif \theta^2 + \sin^2 \theta \dif \phi^2 \right) .
\label{eq:nstars:metric_unstable}
\end{equation}
To make calculations tractable, we assume that the fluid is only \emph{slightly perturbed} from equilibrium.
Following \cite{ref:chandrasekhar_stability}, let us use perturbation theory and express the new functions
\begin{equation}
\begin{aligned}
	\alpha   (t, r) &= \alpha_0  (r) + \delta \alpha  (t, r), & \qquad \qquad
	P        (t, r) &= P_0       (r) + \delta P       (t, r), \\
	\beta    (t, r) &= \beta_0   (r) + \delta \beta   (t, r), & \qquad \qquad
	\epsilon (t, r) &= \epsilon_0(r) + \delta \epsilon(t, r), \\
\end{aligned}
\label{eq:nstars:perturbation_expansion}
\end{equation}
with small perturbations $\delta \alpha$, $\delta \beta$, $\delta P$ and $\delta \epsilon$ around their equilibrium values.
We will now perform all calculations only to first order in these quantities.

We want to determine how these variations displace fluid elements from the unperturbed star to the perturbed star.
Evolution of this quantity should give us insight into how the star responds to perturbations.
Let us therefore define $\xi(t, r)$ so that if we attach a tracker to some fixed fluid element in the star, then
\begin{equation}
\begin{split}
	\text{      in the unperturbed star, } & \text{the fluid element is at $\big(ct,r,\theta,\phi\big)$,} \\
	\text{while in the   perturbed star, } & \text{the fluid element is at $\big(ct,r+\xi(r,t),\theta,\phi\big)$.} \\
\end{split}
\end{equation}
Like $\delta \alpha$, $\delta \beta$, $\delta P$ and $\delta \epsilon$, we treat $\xi$ as a small quantity.
We have chosen to name the displacement $\xi$ instead of, say, $\delta r$, to avoid some confusion that can arise with the radial \emph{coordinate} $r$, hoping to increase readability at the cost of some consistency.

What is the relation between the fluid element displacement $\xi(r,t)$ and the fluid's four-velocity?
By our definition, $\pdv{\xi}/{t} = \odv{r}/{t}$, where the right side is to be interpreted as the derivative of the fluid element's radial coordinate taken \emph{along its worldline} -- or \emph{streamline} -- $x(\tau)$.
The chain rule then gives
\begin{equation}
	\dot\xi = \pdv{\xi}{t} = \odv{r}{t} = \frac{\odv{r}/{\tau}}{\odv{t}/{\tau}} = c \, \frac{u^1}{u^0} .
\end{equation}
We can now express $u^0$ and $u^1$ in terms of $\dot\xi$ by combining this equation with the normalization condition $u_\mu u^\mu = e^{2 \alpha} \left( u^0 \right)^2 - e^{2 \beta} \left( u^1 \right)^2 = c^2$.
To first order in $\dot\xi$ and $\delta \alpha$, we then find
\begin{subequations}
\begin{align}
	u^0 &= \frac{c \, e^{-\alpha}}{\sqrt{1 - \left( e^{\beta-\alpha} \dot\xi / c \right)^2 }} \taylor c \, e^{-\alpha_0} \, (1 - \delta \alpha), \label{eq:nstars:velocity_component_t} \\
	u^1 &= \frac{\dot\xi \, e^{-\alpha}}{\sqrt{1 - \left( e^{\beta-\alpha} \dot\xi / c \right)^2 }} \taylor \dot\xi \, e^{-\alpha_0} . \label{eq:nstars:velocity_component_r}
\end{align}%
\label{eq:nstars:velocity_components}%
\end{subequations}%

In the perturbed system, the field equations \eqref{eq:nstars:field_equations_equilibrium} also change and must be rederived from the Einstein equations \eqref{eq:einstein} in the new metric \eqref{eq:nstars:metric_unstable} subject to the energy-momentum \eqref{eq:nstars:energy_momentum} with the non-equilibrium velocity \eqref{eq:nstars:velocity_components}.
As always, the field equations follow from the machinery of \cref{eq:def_christoffel,eq:def_riemann_tensor,eq:def_ricci_tensor,eq:def_ricci_scalar}.
This time we calculate the field equations only to first order in the small quantities and subtract the equilibrium equations \eqref{eq:nstars:field_equations_equilibrium} to simplify them.
This calculation is easy in principle, but definitely harder in practice.
We therefore borrow the results obtained by \cite[§26.4d]{ref:mtw}, who find that two of the new field equations are
\begin{subequations}
\begin{align}
	%\delta \beta   &= - \frac{4 \pi G}{c^4} (\epsilon_0 + P_0) r e^{2 \beta_0} \xi                                                                                                && \left( G_{01} = \frac{8 \pi G}{c^4} T_{01} \right) , \\
	%\delta \alpha' &= \frac{r}{2 e^{-2 \beta_0}} \left[ \frac{8 \pi G}{c^4} \delta P + 2 e^{-2 \beta_0} \left( \frac{2}{r} \alpha_0' + \frac{1}{r^2} \right) \delta \beta \right] && \left( G_{11} = \frac{8 \pi G}{c^4} T_{11} \right) .
	%%\delta \alpha' &= 4 \pi \left\{ -\gamma P_0 \frac{e^{2 \beta_0}}{r} (r^2 e^{-\alpha_0} \xi)' + \left[ P_0' r - (\epsilon_0 + P_0) e^{2 \beta_0} \xi \right] \right\}
	%
	\frac{2}{r} e^{-(\beta_0 + \alpha_0)} \dot{\delta\beta}                                     &= - \frac{8 \pi G}{c^4} (\epsilon_0 + P_0) e^{\beta_0 - \alpha_0} \dot\xi                         && \left( G_{01} = \frac{8 \pi G}{c^4} T_{01} \right) , \\
	\frac{2}{r} e^{-2\beta_0} \left( \delta\alpha' - \alpha_0' - \frac{\delta \beta}{r} \right) &= \phantom{-} \frac{8 \pi G}{c^4} \delta P                                                                    && \left( G_{11} = \frac{8 \pi G}{c^4} T_{11} \right) .
\end{align}
\end{subequations}
We can erase the two dots in the first equation by performing a time integration, forgetting about the integration constant because we should have $\delta\beta=0$ when we are back in equilibrium with $\xi=0$.
The simplest form of the field equations is therefore
\begin{subequations}
\begin{align}
	\frac{1}{r} e^{-2\beta_0} \delta\beta                                                      &= -           \frac{4 \pi G}{c^4} (\epsilon_0 + P_0) \xi , \label{eq:nstars:field_equations_unstable_01} \\
	\frac{1}{r} e^{-2\beta_0} \left( \delta\alpha' - \alpha_0' - \frac{\delta \beta}{r} \right) &= \phantom{-} \frac{4 \pi G}{c^4} \delta P               . \label{eq:nstars:field_equations_unstable_11}
\end{align}
The non-equilibrium equations \eqref{eq:nstars:field_equations_unstable_01} and \eqref{eq:nstars:field_equations_unstable_11} are analogous to the equilibrium equations \eqref{eq:nstars:field_equations_equilibrium_00} and \eqref{eq:nstars:field_equations_equilibrium_11}.
What is the third equation corresponding to \cref{eq:nstars:field_equations_equilibrium_T}, which we found from conservation of energy-momentum $\nabla_\mu T^{\mu \nu} = 0$ back in \cref{sec:einstein_to_tov}?
In \cref{chap:relfluid}, we study relativistic fluid mechanics and start from $\nabla_\mu T^{\mu \nu} = 0$ to derive the relativistic generalization of the Euler equation,
\begin{equation*}
	  \frac{1}{c^2} \Big( \epsilon + P \Big) u^\mu \nabla_\mu u^\alpha = \nabla^\alpha P - \frac{1}{c^2} u^\alpha u^\mu \nabla_\nu P
	  \qquad \bigg( \nabla_\mu T^{\mu \nu} = 0 \bigg) .
\end{equation*}
By inserting the new four-velocity components \eqref{eq:nstars:velocity_components} and the perturbation expansions \eqref{eq:nstars:perturbation_expansion} into the relativistic Euler equation and performing calculations in the new metric \eqref{eq:nstars:metric_unstable} to first order, \cite[§26.5]{ref:mtw} finds
\begin{equation}
	\Big[ \epsilon_0 + P_0 \Big] e^{2 \beta_0 - 2 \alpha_0} \ddot \xi = -c^2 \Big[ \delta P' - \left( \delta \epsilon + \delta P \right) \alpha_0' - \left( \epsilon_0 + P_0 \right) \delta \alpha' \Big] .
\label{eq:nstars:field_equations_unstable_T}
\end{equation}%
\label{eq:nstars:field_equations_unstable}%
\end{subequations}%
The non-equilibrium system \eqref{eq:nstars:field_equations_unstable} is analogous to equilibrium system \eqref{eq:nstars:field_equations_equilibrium} and consists of \emph{three} equations for the \emph{five} unknowns $\xi$, $\delta P$, $\delta \epsilon$, $\delta \alpha$ and $\delta \beta$.
To complete the set, we will make use of two further results of our study of relativistic fluid mechanics in \cref{chap:relfluid}.

In order to make use of the results of \cref{chap:relfluid} in our context, we must first learn to distinguish between \emph{Eulerian} and \emph{Lagrangian} changes in fluids.
The quantities
\begin{subequations}
\begin{equation}
	\delta f(t, r) = f(t, r) - f_0(r)
\label{eq:nstars:change_eularian}
\end{equation}
that we defined in \cref{eq:nstars:perturbation_expansion} are \textbf{Eulerian changes} in the quantities $f$, measured by an observer who is sitting duck at some \emph{fixed position} $x^\mu = (ct, r, \theta, \phi)$.
In contrast, we define the \textbf{Lagrangian changes}
\begin{equation}
	\Delta f(r,t) = f(r+\xi(r,t), t) - f_0(r)
\label{eq:nstars:change_lagrangian}
\end{equation}
\end{subequations}
as the changes in the same quantities, but measured by an observer who is \emph{moving with the fluid element} as it flows from $r$ to $r + \xi(r,t)$.
One type of change can always be converted into the other through the Taylor expansion
\begin{equation}
\begin{split}
	\Delta f(r,t) &\taylor f(r,t) + \xi(r,t) \, f'(r,t) - f_0(r) \\
	              &= \delta f(r,t) + \xi(r,t) \, f'(r,t) .
\end{split}
\label{eq:nstars:delta_taylor_expansion}
\end{equation}
In words, $\delta$ measures changes at a fixed position but of different fluid elements, while $\Delta$ measures changes of fixed fluid elements but at different positions.
The former stems from our use of perturbation theory, while the latter is a natural tool in fluid mechanics.

In our study of relativistic fluid mechanics in \cref{chap:relfluid}, we also derive the relativistic generalization of conservation of energy in the flow of a fluid,
\begin{equation}
	\odv{\epsilon}{\tau} = u^\mu \nabla_\mu \epsilon = -(\epsilon+P) \nabla_\mu u^\mu  .
\label{eq:nstars:energy_conservation}
\end{equation}
On the left side, note that because the equilibrium energy density $\epsilon_0(r)$ is independent of time, we have $\odv{\epsilon}/{\tau} = \odv{\Delta \epsilon}/{\tau}$.
At first sight, it may sound more correct to write $\odv{\delta \epsilon}/{\tau}$ instead of $\odv{\Delta \epsilon}/{\tau}$.
However, since the derivative $\odv{}/{\tau}$ is \emph{along the streamline} of the fluid element, it is more accurate to use a Lagrangian change over an Eulerian change to first order in perturbation theory.
Since the radial velocity component \eqref{eq:nstars:velocity_component_r} is already a first-order quantity, only the time component \eqref{eq:nstars:velocity_component_t} contributes to
\begin{equation}
\begin{split}
	\odv{\epsilon}{\tau} =
	\odv{\Delta \epsilon}{\tau} =
	u^\mu \nabla_\mu \Delta \epsilon =
	u^0 \nabla_0 \Delta \epsilon + u^1 \nabla_1 \Delta \epsilon
	&\taylor u^0 \pdv{\Delta \epsilon}{t} = u^0 \dot{\Delta \epsilon} =
	e^{-\alpha_0} \dot{\Delta \epsilon} .
\end{split}
\end{equation}
The right side of \cref{eq:nstars:energy_conservation} can be calculated with the identity \cite[equation 3.34]{ref:carroll}
\begin{equation}
	\nabla_\mu u^\mu = \frac{1}{\sqrt{-\det{g}}} \partial_\mu \left( \sqrt{-g} \, u^\mu \right)
	                 = e^{-\alpha_0} \left[ \dot{\delta\beta} + \frac{e^{-\beta_0}}{r^2} \left( e^{\beta_0} r^2 \dot\xi \right)' \right] .
\end{equation}
To first order in the small quantities, \cref{eq:nstars:energy_conservation} then says
\begin{equation}
	\dot{\Delta \epsilon} = - \left( \epsilon_0 + P_0 \right) \left[ \dot{\delta\beta} + \frac{e^{-\beta_0}}{r^2} \left( e^{\beta_0} r^2 \dot\xi \right)' \right] .
\end{equation}
Again, integrate with respect to time to get rid of the dots and set the integration constant to zero, so $\Delta \epsilon = 0$ when $\delta \beta = 0$ and $\xi = 0$.
We then find our fourth main equation
\begin{equation}
	\Delta \epsilon = - \left( \epsilon_0 + P_0 \right) \left[ \delta\beta + \frac{e^{-\beta_0}}{r^2} \left( e^{\beta_0} r^2 \xi \right)' \right] .
\label{eq:nstars:Delta_epsilon}
\end{equation}

We have four equations down, and only one to go.
The last result of \cref{chap:relfluid} that we make use of is adiabaticity of the flow.
In \cref{sec:relfluid:adiabadicity}, we show that the flow of a perfect fluid is adiabatic with the \textbf{adiabatic index}
\begin{equation}
	\gamma = \frac{\epsilon+P}{P} \left( \odv{P}{\epsilon} \right)_s,
\label{eq:nstars:adiabatic_index0}
\end{equation}
where the derivative should be taken at constant specific entropy $s$, that is \emph{along the flow}.
The above expression can be calculated entirely from the fluid's equation of state $\epsilon = \epsilon(P)$, although in its current form, it is the \emph{unknown} perturbed quantities $\epsilon$ and $P$ that enter -- not the known equilibrium quantities $\epsilon_0$ and $P_0$.
However, since the derivative should be taken \emph{along the flow}, we can rewrite it as the ratio of \emph{Lagrangian} changes, so the adiabatic index becomes
\begin{equation}
	\gamma = 
	\frac{\epsilon+P}{P} \frac{\Delta P}{\Delta \epsilon} ,
	\quad \text{or} \quad
	\Delta P = \frac{P}{\epsilon + P} \, \gamma \, \Delta \epsilon .
\label{eq:nstars:adiabatic_index}
\end{equation}
The latter is a relation between two first-order quantities, and so for the purpose of perturbation theory, \emph{the only relevant part of $\gamma$ is the known zeroth-order part}
\begin{equation}
	\gamma_0 = \frac{\epsilon_0+P_0}{P_0} \odv{P_0}{\epsilon_0}
	         = \frac{\epsilon_0+P_0}{P_0} \frac{\Delta P}{\Delta \epsilon} .
\label{eq:nstars:adiabatic_index_first_order}
\end{equation}
The two forms in equation \eqref{eq:nstars:adiabatic_index_first_order} are very similar, but serve distinct uses.
The first version allows us to \emph{calculate} $\gamma_0$ from the equation of state $\epsilon_0(P_0)$ in equilibrium, while the latter gives us our fifth and final main equation
\begin{equation}
	\Delta P = \frac{P_0}{\epsilon_0 + P_0} \, \gamma_0 \, \Delta \epsilon
	         = \odv{P_0}{\epsilon_0} \, \Delta\epsilon .
\label{eq:nstars:Delta_P}
\end{equation}

\subsubsection{Final system of perturbation equations}

We have made quite a big mess by now, but we finally have all the information we need, and it remains only to clean up after ourselves.
Together, equations \eqref{eq:nstars:field_equations_unstable_01}, \eqref{eq:nstars:field_equations_unstable_11}, \eqref{eq:nstars:field_equations_unstable_T}, \eqref{eq:nstars:Delta_epsilon} and \eqref{eq:nstars:Delta_P} constitute the system of five equations
\begin{subequations}
\begin{align}
	\frac{1}{r} e^{-2\beta_0} \delta\beta                                                                                & \quad = \quad -           \frac{4 \pi G}{c^4} \Big[ \epsilon_0 + P_0 \Big] \xi , \label{eq:nstars:perturbation_system_01} \\[1.0ex]
	\frac{1}{r} e^{-2\beta_0} \Big[ \delta\alpha' - \alpha_0' - \frac{\delta \beta}{r} \Big]                             & \quad = \quad \frac{4 \pi G}{c^4} \delta P               , \label{eq:nstars:perturbation_system_11} \\[1.0ex]
	\Big[ \epsilon_0 + P_0 \Big] e^{2 \beta_0 - 2 \alpha_0} \ddot \xi                                                    & \quad = \quad -c^2 \Big[ \delta P' - \left( \delta \epsilon + \delta P \right) \alpha_0' - \left( \epsilon_0 + P_0 \right) \delta \alpha' \Big] , \label{eq:nstars:perturbation_system_euler} \\[1.0ex]
	\Delta \epsilon                                                                                                      & \quad = \quad - \left( \epsilon_0 + P_0 \right) \left[ \delta\beta + \frac{e^{-\beta_0}}{r^2} \left( r^2 e^{\beta_0} \xi \right)' \right]  , \label{eq:nstars:perturbation_system_energy_conservation} \\[1.0ex]
	\Delta P                                                                                                             & \quad = \quad \frac{P_0}{\epsilon_0 + P_0} \, \gamma_0 \, \Delta \epsilon , \label{eq:nstars:perturbation_system_adiabadicity}
\end{align}%
\label{eq:nstars:perturbation_system}%
\end{subequations}%
for the five unknowns $\xi$, $\delta \alpha$, $\delta \beta$, $\delta P$ and $\delta \epsilon$.
Remember that any occurrence of $\Delta P$ and $\Delta \epsilon$ can be traded for $\delta P$ and $\delta \epsilon$ by the Taylor expansion \eqref{eq:nstars:delta_taylor_expansion}.
Except for the independent variables $t$ and $r$, the only other quantities are the equilibrium values $\alpha_0$, $\beta_0$, $P_0$ and $\epsilon_0$ and derivatives thereof, all of which are obtained by solving the Tolman-Oppenheimer-Volkoff equations \eqref{eq:tov:tovsys}!

It is the displacement $\xi(t,r)$ we want to calculate, so let us reduce the system \eqref{eq:nstars:perturbation_system} to a differential equation involving it as the only dependent variable.
Along the way, it is convenient to define
\begin{equation}
	\zeta(t,r) = r^2 e^{\beta_0(r)} \xi(t,r),
\label{eq:nstars:definition_zeta}
\end{equation}
because the only spatial derivative of $\xi$ in the system \eqref{eq:nstars:perturbation_system} appears through this combination in \cref{eq:nstars:perturbation_system_energy_conservation}.
Never forget that we are doing perturbation theory, so we can still neglect any product of two small quantities, and we can simplify expressions using any equilibrium equation from above.
Again, the work before us is easy in principle and hard in practice.
In the end, \cite[equation 26.19]{ref:mtw} find that $\zeta$ obeys the differential equation
\begin{equation}
	W(r) \ddot{\zeta}(r,t) = \left[ \Pi(r) \zeta'(r) \right]' + Q(r) \zeta(r) ,
\label{eq:nstars:diffeq_zeta}
\end{equation}
where the coefficient functions are
\begin{subequations}
\begin{align}
	\Pi &= \frac{1}{r^2} e^{\beta_0 + 3 \alpha_0} \gamma_0 P_0 , \label{eq:nstars:sturm_liouville_coefficients_Pi} \\
	Q   &= -\frac{4}{r^3} e^{\beta_0 + 3 \alpha_0} P_0' - \frac{8 \pi G}{c^4} \frac{1}{r^2} e^{3 \beta_0 + 3 \alpha_0} P (\epsilon_0 + P_0) + \frac{e^{\beta_0 + 3 \alpha_0}}{r^2(\epsilon_0 + P_0)} \left( P_0' \right)^2 , \label{eq:nstars:sturm_liouville_coefficients_Q} \\
	W   &= \frac{1}{c^2 r^2} e^{3 \beta_0 + \alpha_0} (\epsilon_0 + P_0) . \label{eq:nstars:sturm_liouville_coefficients_W}
\end{align}
\label{eq:nstars:sturm_liouville_coefficients}
\end{subequations}
This differential equation governs the displacement $\xi(t,r)$ through definition \eqref{eq:nstars:definition_zeta}.

\subsubsection{General Sturm-Liouville solution for the fluid displacement}

We can find a solution to the differential equation \eqref{eq:nstars:diffeq_zeta} using separation of variables.
Let us assume a solution of the form
\begin{equation}
	\zeta(t,r) = T(t) \, U(r) .
\label{eq:nstars:separation_of_variables}
\end{equation}
Substituting the trial solution \eqref{eq:nstars:separation_of_variables} into the differential equation \eqref{eq:nstars:diffeq_zeta} and dividing by $W U T$, we see that
\begin{equation}
	\frac{\ddot{T}(t)}{T(t)} = \frac{\left[ \Pi(r) \, U'(r) \right]' + Q(r) \, U(r)}{W(r) \, U(r)} = -\omega^2
\end{equation}
must be a constant $-\omega^2$, which can be any complex number at this stage.
We then find the temporal solutions $T(t) = e^{\pm i \omega t}$, while the spatial function $U(r)$ and $\omega^2$ must solve
\begin{equation}
	\odv*{ \left[ \Pi(r) \odv{U(r)}{r} \right] }{r} + \bigg[ Q(r) + \omega^2 W(r) \bigg] U(r) = 0 .
\label{eq:nstars:diffeq_U}
\end{equation}

What are the boundary equations for $U(r)$?
At the center $r = 0$, spherical symmetry implies that there can be no flow, so the physical boundary condition there is
\begin{equation}
	\xi(t, 0) = 0.
\label{eq:nstars:boundary_condition_center_physical}
\end{equation}
In addition, \cite{ref:stability_methods} argues that $\xi'(t,0) > 0$ must be finite at the center.
From definitions \eqref{eq:nstars:definition_zeta} and \eqref{eq:nstars:separation_of_variables}, we see that these two requirements are satisfied only if
\begin{equation}
	U(r) \propto r^3
	\qquad \text{near } r = 0.
\label{eq:nstars:boundary_condition_center_mathematical}
\end{equation}
At the surface $r = R$, there can be no change in pressure as one follows a fluid element, just like at the interface between water and air down on Earth.
Here, the boundary condition is therefore the vanishing of the \emph{Lagrangian} pressure change
\begin{equation}
	\Delta P = 0
	\qquad \text{at } r = R.
\label{eq:nstars:boundary_condition_surface_physical}
\end{equation}
From \cref{eq:nstars:Delta_P}, we see that this is equivalent to
\begin{equation}
	\Delta P = \odv{P_0}{\epsilon_0} \Delta \epsilon = \left( \frac{v_0}{c} \right)^2 \Delta\epsilon ,
\label{eq:nstars:deltaP_product}
\end{equation}
where we recognize the speed of sound $v_0 = c \sqrt{\odv{P_0}/{\epsilon_0}}$.
The surface $r = R$ is defined by $P_0(r) = 0$, and where there is no pressure, there can be no sound, so we should have $v_0 = 0$.
%\TODO{but is not true for conformal limit where $\epsilon = 3 P$ ! write about this here?}
This can be confirmed from the equation of state.
Close to the surface, the density \eqref{eq:nstars:density_zeroT} is small, so $x_F$ is small, and $\odv{P_0}/{\epsilon_0} \rightarrow 0$ as $x_F \rightarrow 0$ by \cref{eq:nstars:dPde}.
\iffalse
Close to the surface, the pressure \eqref{eq:nstars:pressure_zeroT} is small by definition, so $x_F$ is also small, and it is therefore the non-relativistic equation of state \eqref{eq:nstars:nr_eos} that reigns.
Its derivative is
\begin{equation}
	\odv{\epsilon_0}{P_0} \propto \odv{P_0^{3/5}}{P_0} \propto P_0^{-2/5} = \infty ,
	\qquad \text{so} \qquad
	v_s^2 \propto \odv{P_0}{\epsilon_0} = \frac{1}{\odv{\epsilon_0}/{P_0}} = \frac{1}{\infty} = 0
	\quad \text{at } r = R.
\end{equation}
Of course, this is not the case for the ultra-relativistic equation of state \eqref{eq:nstars:ur_eos}, but it holds only where $x_F$ is large and thus nowhere near the surface!
\fi
Hence, the first factor $\odv{P_0}/{\epsilon_0}$ of the product \eqref{eq:nstars:deltaP_product} is zero, and the whole product will vanish \emph{provided that} the second factor $\Delta \epsilon$ is finite.
Glancing back at expression \eqref{eq:nstars:perturbation_system_adiabadicity} for $\Delta \epsilon$, it then follows that the boundary condition \eqref{eq:nstars:boundary_condition_surface_physical} is \emph{automatically} satisfied \emph{provided that}
\begin{equation}
	\Delta \epsilon = - \left( \epsilon_0 + P_0 \right) \left[ \delta\beta + \frac{e^{-\beta_0}}{r^2} \odv{U}{r} e^{i \omega t} \right] \quad \text{is finite at $r=R$}.
\end{equation}
By definition, $P_0 = 0$ and $\epsilon_0=0$ at the surface.
By assumption, $\delta\beta$ is a small and thus finite quantity, and $e^{-\beta_0(R)} = \left( 1 - 2 G M / R c^2 \right)^{-1/2}$ is also finite at the surface.
The translation of the boundary condition \eqref{eq:nstars:boundary_condition_surface_physical} at the surface into a criterion on $U(r)$ is therefore \emph{only} that
\begin{equation}
	\odv{U(r)}{r} \quad \text{is finite at $r=R$}.
\label{eq:nstars:boundary_condition_surface_mathematical}
\end{equation}
This may sound unnecessarily picky at this point, but we will soon see that the finiteness of $U$ plays a very important role when solving the differential equation.

The differential equation \eqref{eq:nstars:diffeq_U} subject to the boundary conditions \eqref{eq:nstars:boundary_condition_center_mathematical} and \eqref{eq:nstars:boundary_condition_surface_mathematical} is a \textbf{Sturm-Liouville problem} for \emph{multiple} eigenfunctions $U(r) = U_n(r)$ with corresponding eigenvalues $\omega^2 = \omega_n^2$.
It is best viewed as the eigenvalue equation
\begin{subequations}
\begin{align}
	&\odv*{ \left[ \Pi(r) \odv{U_n(r)}{r} \right] }{r} + Q(r) \, U_n(r) = -\omega_n^2 W(r) U_n(r) && \text{for } 0 \leq r \leq R , \label{eq:nstars:sturm_liouville} \\
	\text{subject to} \quad & U_n(r)          \propto r^3    && \text{near } r=0 , \label{eq:nstars:sturm_liouville_boundary_condition1} \\
	\text{and}        \quad & \odv{U_n(r)}{r} <       \infty && \text{at } r=R . \label{eq:nstars:sturm_liouville_boundary_condition2}
\end{align}%
\label{eq:nstars:sturm_liouville_problem}%
\end{subequations}
We will always take $U_n(r)$ to be a real solution -- for if $U_n$ is a complex solution, then so is $\conj{U_n}$ and thus also $\real{U_n} = (U_n + \conj{U_n})/2$, by linearity.
Let us show that in the form above, the Sturm-Liouville equation is expressed in a self-adjoint form with respect to the inner product
\begin{equation}
	\braket{f | g} = \int_0^R \dif r \, f(r) g(r) .
\label{eq:nstars:function_inner_product}
\end{equation}
Denoting the left side of \cref{eq:nstars:sturm_liouville} by $\hat{L} U_n = \hat{L}(r) U_n(r)$, we can integrate by parts twice to show that for two solutions $U_m(r)$ and $U_n(r)$,
\begin{equation}
\begin{split}
	\Braket{\hat{L} U_m | U_n} &= \int_0^R \dif r \, \left[ \left( \Pi U_m' \right)' U_n + Q U_m U_n \right] \\
	                           &= \Big[ \Pi \, U_m' \, U_n \Big]_{r=0}^{r=R} + \int_0^R \dif r \, \Big[ - \Pi U_m' U_n' + Q U_m U_n \Big] \\
	                           &= \Big[ \Pi \, U_m' \, U_n \Big]_{r=0}^{r=R} - \Big[ \Pi \, U_m \, U_n' \Big]_{r=0}^{r=R} + \int_0^R \dif r \, \Big[ \left( \Pi U_n' \right)' U_m + Q U_m U_n \Big] \\
	                           &= \Big[ \Pi \, U_m' \, U_n \Big]_{r=0}^{r=R} - \Big[ \Pi \, U_m \, U_n' \Big]_{r=0}^{r=R} + \Braket{U_m | \hat{L} U_n} \\
	                           &= \Braket{U_m | \hat{L} U_n} .
\label{eq:nstars:inner_product_hermitean}
\end{split}
\end{equation}
The surface terms at $r = 0$ vanish because $U_n(0) = U_m(0) = 0$ there by boundary condition \eqref{eq:nstars:boundary_condition_center_mathematical}, while the surface terms at $r = R$ vanish because $P_0(R) = 0$ there, causing $\Pi(R) = 0$ from its definition \eqref{eq:nstars:sturm_liouville_coefficients_Pi}.
Using the inner product \eqref{eq:nstars:function_inner_product} and property \eqref{eq:nstars:inner_product_hermitean}, one can dive into the field of Sturm-Liouville theory, where one will discover the following important properties:
\begin{subequations}
\begin{enumerate}
\item \label{item:nstars:sturm_liouville_eigenvalues} The eigenvalues $\omega_n^2$ are real and form an infinite, discrete sequence
\begin{equation}
	\omega_0^2 < \omega_1^2 < \omega_2^2 < \cdots
\end{equation}
that is bounded from below, but not from above.

\item \label{item:nstars:sturm_liouville_zeros} The eigenfunction $U_n(r)$ corresponding to the eigenvalue $\omega_n^2$ has exactly
\begin{equation}
	n \text{ zeros } U_n(r) = 0 \quad \text{for} \quad 0 < r < R .
\end{equation}

\item \label{item:nstars:sturm_liouville_completeness} Eigenfunctions $U_n(r)$ corresponding to different eigenvalues $\omega_n^2$ are different, and constitute an orthonormal basis for the Hilbert space of real, square integrable functions on $[0, R]$ under the $W$-weighted inner product 
\begin{equation}
	\braket{U_m | U_n}_W = \braket{W U_m | U_n} = \delta_{m n} .
\end{equation}
\end{enumerate}
\end{subequations}

The property that the eigenvalues are real is possible for us to prove, and we should, because we will take it as an assumption when we solve the Sturm-Liouville problem numerically.
Applying property \eqref{eq:nstars:inner_product_hermitean} with $U_m = U_n$, we have $\braket{\hat{L} U_n | U_n} = \conj{\braket{\hat{L} U_n | U_n}}$.
Exchanging the left side of $\hat{L} U_n = -\omega_n^2 W U_n$ with the right and noting that $\braket{W U_n | U_n}$ is real because $W$ and $\Abs{U_n}^2$ are real, this is equivalent to $-\omega_n^2 \braket{W U_n | U_n} = \conj{\left( -\omega_n^2 \right)} \braket{W U_n | U_n}$, so $\omega_n^2$ is real.
%Proving the last part takes more work, but we will that it plays out in practice when solving the Sturm-Liouville problem numerically soon.

We can also understand intuitively why the number of zeros must increase with $\omega_n^2$.
By rewriting the Sturm-Liouville equation as $\left( \Pi U_n' \right)' / U_n = - \left( Q + \omega_n^2 W \right)$ and noting that $W > 0$ by its definition \eqref{eq:nstars:sturm_liouville_coefficients_W}, it is apparent that as $\omega_n^2$ increases, so does the curvature of $U_n$ towards $0$, and hence the number of zeros.

For a greater overview of Sturm-Liouville theory and proofs of the other properties, we recommend \cite{ref:morse_feshbach}.
Perhaps, it can also be comforting to think of a more familiar example of applied Sturm-Liouville theory, namely the time-independent Schrödinger equation $\left[ \left(-\hbar^2/2m\right)\odv[2]{}/{x} + V(x) \right] \psi_n(x) = E_n \psi_n(x)$.
Here, the energies $E_n$ play the role of the eigenvalues $\omega_n^2$ and the wave functions $\psi_n(x)$ are analogous to the eigenfunctions $U_n(r)$.
In one dimension, normalizable solutions to the Schrödinger equation possess precisely the same three properties as above.

\iffalse
We can give a quick proof of the first part.
Property \eqref{eq:nstars:inner_product_hermitean} implies that $-\omega_n^2 \braket{W U_n  | U_m} = -\omega_m^2 \braket{W U_m | U_n}$, so $\left( \omega_m^2 - \omega_n^2 \right) \braket{W U_m | U_n} = 0$.
If $U_m = U_n$ are equal, then $\braket{W U_m | U_n} \neq 0$, so $\omega_m^2 = \omega_n^2$ must be equal.
On the other hand, if $\omega_m^2 \neq \omega_n^2$, then $\braket{W U_m | U_n} = 0$, and $U_m \neq U_n$ must be different.
\fi

\subsubsection{Necessary and sufficient criterion for stellar stability}

At long last, we are now in position to state a rigorous mathematical criterion of stellar stability.
Property \ref{item:nstars:sturm_liouville_completeness} implies that any physically reasonable displacement $\xi(t,r)$ can be written as a linear combination
\begin{equation}
	\xi(t,r) = \frac{e^{-\beta_0(r)}}{r^2} \sum_n c_n U_n(r) e^{i \omega_n t}
\label{eq:nstars:displacement_general_solution}
\end{equation}
for some constants $c_n$.
The superposition will still satisfy the physical boundary conditions \eqref{eq:nstars:boundary_condition_center_physical} and \eqref{eq:nstars:boundary_condition_surface_physical}, provided that each $U_n(r)$ separately satisfies the boundary conditions \eqref{eq:nstars:boundary_condition_center_mathematical} and \eqref{eq:nstars:boundary_condition_surface_mathematical}.
Property \ref{item:nstars:sturm_liouville_eigenvalues} ensures all $\omega_n^2$ are real, \emph{but there is no restriction on the sign of $\omega_n^2$}.

\begin{itemize}
\item If $\omega_0^2 > 0$, then all vibration modes have real frequencies $\omega_n > 0$.
      Then all terms in the displacement \eqref{eq:nstars:displacement_general_solution} merely oscillate back and forth like $\xi \propto e^{i \omega_n t}$, so the star attempts to return to equilibrium, and it is \textbf{stable}.
\item If $\omega_0^2 < 0$, then one or more vibration modes have imaginary frequencies $\omega_n = \pm i \Abs{\omega_n}$.
      Then some term in the displacement \eqref{eq:nstars:displacement_general_solution} takes off exponentially like $\xi \propto e^{\pm \Abs{\omega_n} t}$, so the star either implodes or explodes, and it is \textbf{unstable}.
\end{itemize}
A prerequisite for the above criterion is that it is sufficient for \emph{one} mode in the displacement \eqref{eq:nstars:displacement_general_solution} to be unstable for the star as a whole to be unstable.
To understand this, suppose a star is exposed to some external perturbation $\xi(t,r)$.
Whatever the source of this perturbation -- be it the touch of a finger, an imperfection in the star's material or the blast from a nearby supernova explosion -- it is the initial state $\xi(t,r)$ of this \emph{external} perturbation that determines the contribution $c_n$ from each mode in the sum \eqref{eq:nstars:displacement_general_solution}, and subsequently the \emph{response} of the star to the perturbation.
In the real world, we expect that any external perturbation will activate \emph{all} modes $U_n(r)$ to some extent -- for one would need remarkable finger precision to perturb the star in an \emph{exact} superposition of only a finite selection of modes.
Given that all modes have even the slightest nonzero contribution $c_n \neq 0$, the presence of \emph{any} exponential term is sufficient for the whole sum to collapse or grow unbounded towards $0$ or $\infty$.

A clever and perhaps slightly nitpicky objection to our criterion, is that the perturbative exponential growth should not be valid once the perturbation has grown outside the domain where it is valid.
Either way, we would still say that the star is \emph{locally} unstable in the immediate vicinity of the equilibrium.
\emph{If} a star were to reach another state of equilibrium once it has grown outside this domain of validity, then that new state must necessarily also be either stable or unstable.
If it is stable, then it is either a neutron star on a different part of the mass-radius curve we have found, or it has evolved to a completely different type of star on a mass-radius curve that we do not know about.
If it is unstable, then we would recursively enter the beginning of this argument again.
Ultimately, what is physically interesting to us are the (locally) stable configurations, as any unstable star will either explode, collapse, evolve to one of the stable configurations or transition to a completely different type of star.

% \TODO{can the instability stuff be connect to attractor/chaos stuff from nonlinear dynamics? Svar: check fixed points from nonlinear dynamics, check stability by checking the sign of the jacobian matrix or something?}

\subsubsection{Numerical solution of the Sturm-Liouville problem with the shooting method}

Multiple methods for determining the stability of stars through the criterion above are catalogued by \cite{ref:stability_methods}.
The \textbf{shooting method} is a particularly fun numerical technique for finding the eigenfunctions $U_n(r)$ and eigenvalues $\omega_n^2$ of the Sturm-Liouville problem \eqref{eq:nstars:sturm_liouville_problem}.
Let us put it to use, so we can determine the stability of the stars along the curve in \cref{fig:nstars:massradius}.

\begin{figure}
\tikzsetnextfilename{shooting-convergence}
\begin{tikzpicture}
\pgfplotstableread{../code/data/shoot.dat}{\shoottable}
\pgfplotstablegetrowsof{\shoottable}
\pgfmathparse{int(\pgfplotsretval-1)}
\pgfplotstablegetelem{\pgfmathresult}{r}\of{\shoottable}
\pgfmathsetmacro{\maxR}{\pgfplotsretval}
\begin{axis}[
	width=15cm, height=10cm,
	xlabel=$r \, / \, R$, ylabel=$U(r) \, / \, \max \Abs{U_0(r)}$,
	title={Convergence of $U(r) \rightarrow U_0(r)$ as $\omega^2 \rightarrow \omega_0^2$ with the shooting method},
	%every axis title/.style={at={(0.5,1)}, align=center, above=1ex, text width=0.8*\pgfkeysvalueof{/pgfplots/width}]},
	xmin=0, xmax=1, ymin=-2.0, ymax=+2.0,
	xtick distance=0.25, minor x tick num=4,
	ytick distance=2, minor y tick num=3, ymajorgrids, minor grid style={loosely dashed}, yminorgrids, extra y ticks = {-1, +1}, extra y tick style={grid=none},
	legend style={anchor=north, at={(0.5, -0.25)}},
	legend columns=8, transpose legend,
	legend cell align=right,
	colormap name=blackred, cycle list={[samples of colormap=32]},
	clip mode=individual,
]
%\addlegendimage{empty legend}
%\addlegendentry{\hspace{-0.6cm}\textbf{Value of $\omega^2$}} % hack for legend title: https://tex.stackexchange.com/questions/2311/add-a-legend-title-to-the-legend-box-with-pgfplots
\pgfplotsinvokeforeach{0,...,31}{ % 31, it works but it is very slow
	\pgfmathparse{int(200 + 800 * (0.0 + 0.6 * #1 / 31))} % lin interp 50 -> 100
	\pgfmathsetmacro{\clrintensity}{\pgfmathresult}
	\pgfplotstablegetelem{#1}{nn}\of{\shoottable}
	\ifthenelse{\equal{\pgfplotsretval}{1}}{
		%\edef\mycolor{purple!\clrintensity!red}
		\edef\mycolor{color of colormap={\clrintensity of colormap/RdPu}}
	}{
		%\edef\mycolor{purple!\clrintensity!blue}
		\edef\mycolor{color of colormap={\clrintensity of colormap/BuPu}}
	}
	\edef\temp{\noexpand\addplot+ [\mycolor, restrict y to domain=-5:5] table [x expr=\noexpand\thisrow{r}/\maxR, y expr={\noexpand\thisrow{U#1} / 0.000312}] {../code/data/shoot.dat};} % faster to read directly from file for some reason
	\temp
	%\addplot+ [thick, restrict y to domain=-5:5] table [x expr=\thisrow{r}/\maxR, y expr={\thisrow{U#1} / 0.000312}] {../code/data/shoot.dat}; % faster to read directly from file for some reason
	\pgfplotstablegetelem{#1}{omega2}\of{\shoottable} % get value of \omega^2
	\addlegendentryexpanded{$\pgfmathprintnumber[precision=10, fixed, fixed zerofill]{\pgfplotsretval}$}; % pgfplotsretval is still omega2
}
\node [text=black, anchor=north] at (axis description cs:0.5,-0.15) {Value of $\hat{\omega}^2 = \omega^2 \, / \, (c/\SI{10}{\kilo\meter})^2$};
%\addplot [forget plot, dashed, domain=0:5, restrict y to domain=0:2.0, samples=50] {(x*\maxR)^3 / 0.000312} node[pos=0.6, label={[xshift=+0ex]135:$\propto r^3$}] {};
\addplot [forget plot, dashed, domain=0:0.2, restrict y to domain=0:2, samples=100] {700*x^3} node[pos=0.55, label={[xshift=+1ex]135:$\propto r^3$}] {};
\end{axis}
\end{tikzpicture}
\caption{\label{fig:nstars:shooting_convergence}%
	The shooting method finds the eigenvalue $\omega_n^2$ and corresponding eigenfunction $U_n(r)$ with $n=0$ of a Sturm-Liouville problem \eqref{eq:nstars:sturm_liouville_problem}.
	It guesses the eigenvalue $\omega^2$, imposes the boundary condition \eqref{eq:nstars:sturm_liouville_boundary_condition1} near $r = 0$, ``shoots'' across to $r=R$ by integrating the differential equation \eqref{eq:nstars:sturm_liouville} and checks whether $U(r)$ ``hits'' boundary condition \eqref{eq:nstars:sturm_liouville_boundary_condition2} there.
	By comparing the number of nodes $n(\omega^2)$ of $U(r)$ to $n$, the guess is intelligently improved and the process repeated, arriving ever closer to the true eigenvalue $\omega_n^2$.
	First, the algorithm establishes two bounds $\hat{\omega}_-^2 = -16$ and $\hat{\omega}_+^2 = 0$ whose corresponding solutions have $n(\omega_-^2) \leq n$ and $n(\omega_+^2) > n$ nodes.
	The exact squared frequency is then guaranteed to lie in $\omega_-^2 < \omega_n^2 < \omega_+^2$.
	Next, the algorithm finds the number of nodes corresponding to $\hat{\omega}^2 = (\hat{\omega}_-^2 + \hat{\omega}_+^2) / 2 = -8$.
	Here, it is found to have $n(\omega^2) > n$ nodes, so the process is repeated with the tighter upper bound $\hat{\omega}_+^2 = -8$.
	In the opposite case $n(\omega^2) \leq n$, $-8$ would rather be a better lower bound $\hat{\omega}_-^2$.
	The algorithm continues to split the $[\omega_-^2, \, \omega_+^2]$ in this fashion until the bounds are so close that any value in the interval is satisfactory.
	In the plot, \textcolor{blue}{blue} lines correspond to \textcolor{blue}{lower bounds $\omega_-^2$}, \textcolor{red}{red} lines to \textcolor{red}{upper bounds $\omega_+^2$}, and increasingly \textcolor{purple}{mixed colors} to later guesses.
	%That is, the most \textcolor{purple}{purple} line is closest to the real solution.
}
\end{figure}

\begin{figure}
\centering
\tikzsetnextfilename{shooting-modes}
\begin{tikzpicture}
\pgfplotsset{cycle list/Set1} % or Dark2
\pgfplotstableread{../code/data/nmodes_norm.dat}{\nmodestable};
\pgfplotstablegetrowsof{\nmodestable}
\pgfmathparse{int(\pgfmathresult-1)}
\pgfplotstablegetelem{\pgfmathresult}{r}\of{\nmodestable}
\pgfmathsetmacro{\maxR}{\pgfplotsretval}
\begin{groupplot}[
	group style={group size=1 by 2, horizontal sep=5pt, vertical sep=5pt},
	width=15cm, height=9.2cm,
	xmin=-0.0, xmax=1.0, ymin=-1.1, ymax=+1.1, restrict y to domain=-50:+50,
	xtick={0,0.25,0.5,0.75,1}, ytick distance=2.0, minor y tick num=3, extra y ticks={-1,1}, extra y tick style={grid=minor},
	minor x tick num=4,
	ymajorgrids, yminorgrids, minor grid style={loosely dashed},
	%cycle list name=Dark2,%no markers, cycle list name=color list, % or exotic
	cycle multi list={
		solid, dashed\nextlist
		Set1NoYellow % or Set1
	},
]
\nextgroupplot[
	every axis title/.style={at={(0.03,0.07)}, text width=5cm, anchor=south west, draw=black, fill=white},
	title={\subcaption{\label{fig:nstars:modes_normed_separate}Separate normalization}},
	ylabel={$U_n(r) \, / \, \max \Abs{U_n(r)}$},
	legend cell align=left, legend columns=3, legend style={at={(0.5, 1.03)}, anchor=south},
	xticklabels={},
	%title = {Lowest normal vibration modes}, title style = {anchor=south, at={(0.5, 1.3)}, draw=none}, % TODO: already have title for this
]
\pgfplotsinvokeforeach{0,1,...,7} {
	\addplot+ table [x expr=\thisrow{r}/\maxR, y=U#1] {\nmodestable};
	\pgfplotstablegetelem{#1}{omega2}\of{\nmodestable}
	%\pgfmathparse{sign(\pgfplotsretval)*sqrt(abs(\pgfplotsretval)) * 2.99e+1} % display in meaningful units, mult by c/r0
	\pgfkeys{/pgf/fpu=true}
	\pgfmathparse{\pgfplotsretval * 2.99^2 * 1e2} % express ω2 = ω2hat * KHz^2
	\pgfmathparse{sign(\pgfmathresult) * sqrt(abs(\pgfmathresult))} % take square, but keep sign
	\addlegendentryexpanded{$\omega_{#1}^2 = \pgfmathprintnumber[fixed, fixed zerofill, precision=0, set thousands separator={}, showpos=true]{\pgfmathresult}^2 \, \si{\kilo\hertz\squared}$};
	\pgfkeys{/pgf/fpu=false}
}

\nextgroupplot[
	every axis title/.style={at={(0.97,0.07)}, text width=5cm, anchor=south east, draw=black, fill=white},
	title={\subcaption{\label{fig:nstars:modes_normed_common}Common normalization}},
	xlabel={$r \, / \, R$}, ylabel={$U_n(r) \, / \, \max \Abs{U_0(r)}$},
];
\tablemaximum{../code/data/nmodes.dat}{U0}{\maxU}{r}{\maxr}
\pgfplotsinvokeforeach{0,1,...,7} {
	\addplot+ table [x expr=\thisrow{r}/\maxR, y expr=\thisrow{U#1}/\maxU] {../code/data/nmodes.dat};
}
\addplot [dashed, domain=0:0.5, restrict y to domain=0:2.0, samples=100] {(x*\maxR)^3 / \maxU} node[pos=0.40, label={[xshift=+0ex]135:$\propto r^3$}] {};
%\addplot [forget plot, dashed, domain=0:0.2, restrict y to domain=0:2, samples=100] {700*x^3} node[pos=0.55, label={[xshift=+1ex]135:$\propto r^3$}] {};
\end{groupplot}
\end{tikzpicture}
\caption{\label{fig:nstars:modes}%
Eight lowest vibration modes $U_n(r)$ and squared eigenfrequencies $\omega_n^2$ for an unstable ideal neutron star with central pressure $P = \SI{1.28e37}{\pascal}$.
In \subref{fig:nstars:modes_normed_separate}, eigenfunctions are normalized to their own maxima, making their shape throughout the star and the boundary condition $U_n(R) < \infty$ clear.
In \subref{fig:nstars:modes_normed_common}, they are instead normalized to a common scale, highlighting the boundary condition $U_n(r \rightarrow 0) \propto r^3$ and their number of nodes.
We have cut away the divergent parts as $r \rightarrow R$ from the final iteration of the shooting method.
}
\end{figure}

\begin{figure}
\centering
\tikzsetnextfilename{stability-frequencies}
\begin{tikzpicture}
\begin{axis}[
	width=15cm, height=10cm,
	xlabel = $\log_{10} \left( P_c \, / \, \si{\pascal} \right)$,
	ylabel = $\omega_n^2 \, / \, \si{\kilo\hertz\squared}$,
	enlarge x limits=false,
	ymin=-25000, ymax=+25000,
	scaled y ticks=false, yticklabel={$\pgfmathprintnumber[fixed]{\tick}$},
	%title = {},
	cycle list name = {Set1NoYellow},
	grid style={solid}, grid,
	declare function={
		e0 = 4.266500881855305e+34;
	},
	legend pos = south west,
]
\pgfplotsinvokeforeach{0,...,5}{
	\addplot+ [solid] table [x expr={log10(\thisrow{P}*e0)}, y expr={\thisrow{omega2#1} * 2.99^2 * 1e2}] {../code/data/gr.dat};
	\addlegendentryexpanded{$\omega_{#1}^2$};
}
\end{axis}
\end{tikzpicture}
\caption{\label{fig:nstars:stability_frequencies}
	Squared eigenfrequencies $\omega_n^2$ of the six lowest vibration modes for all stars on the bottom sequence in \cref{fig:nstars:massradius} obtained with the shooting method.
	As the central pressure rises, numerical difficulties of integrating the Sturm-Liouville equation makes the curves shaky.
}
\end{figure}

We describe the shooting method and our implementation of it in detail in \cref{sec:numerics:shooting_method}.
It is also possible to understand the gist of it from \cref{fig:nstars:shooting_convergence}, where we show how it establishes the fundamental vibration mode $U_0(r)$ and $\omega_0^2$ for some star by an intelligent form of ``trial and error''.
In \cref{fig:nstars:modes}, we display the eight lowest modes obtained with the shooting method for one particular star.
It is meant to demonstrate the boundary conditions \eqref{eq:nstars:sturm_liouville_boundary_condition1} and \eqref{eq:nstars:sturm_liouville_boundary_condition2}, and that the eigenfunction $U_n(r)$ has exactly $n$ nodes.

Finally, we use the shooting method to examine the stability of every star along the curve in \cref{fig:nstars:massradius}.
In \cref{fig:nstars:stability_frequencies}, we show the six lowest squared eigenvalues $\omega_n^2$ for all stars on the curve.
As the central pressure increases, we see that more squared eigenvalues become negative.
We then simply count the number of unstable modes with $\omega_n^2 < 0$ for every star, and display this number in \cref{fig:nstars:stability}.
The results are very interesting.
\begin{enumerate}
\item Starting from the lowest central pressure, and hence lowest central energy and mass densities, all stars are \emph{stable} up until the maximum mass.
      The part on this segment with the lowest central energy density is the territory of Newtonian theory, where we should already expect stars to be stable, but that the situation remains so as relativistic effects take over is not necessarily obvious.
\item At the point of maximum mass, stars gain \emph{one unstable mode}, and the number stays constant as we follow the curve down to the point of the spiral with minimal mass.
      From the necessary stability condition \eqref{eq:nstars:stability_mass_pressure}, we already know that stars on this segment should indeed be unstable.
\item Beyond the spiral's point of minimal mass, stars acquire a \emph{second unstable mode}.
\item In the innermost parts of the spiral after the next local mass maximum, there even seems to be some stars with a \emph{third unstable mode}.
      The effect is not as crystal clear as it is with the previous segments, however.
\end{enumerate}

Our computations suggest that at every local mass extremum point where $\odv{M(P_c)}/{P_c} = 0$, stars acquire one additional unstable vibration mode, starting with zero unstable modes for the lowest pressures $P_c \rightarrow 0$.
In fact, \cite{ref:stability_methods} presents a method for determining stability of stars based on this principle!
For a sequence of \emph{cold} stars -- like ours -- in a mass-radius diagram like \cref{fig:nstars:massradius}, they claim that:
\begin{itemize}
\item For the lowermost central energy densities $\epsilon(P_c)$, we know from classical theory that stars are \emph{stable}.
\item At every local mass extremum $\odv{M(P_c)}/{P_c} = 0$ where the curve bends \emph{counterclockwise} as the central pressure increases, one \emph{stable} mode becomes \emph{unstable}.
\item At every local mass extremum $\odv{M(P_c)}/{P_c} = 0$ where the curve bends \emph{clockwise} as the central pressure increases, one \emph{unstable} mode becomes \emph{stable}.
\end{itemize}
Our curve only includes a spiral turning counterclockwise and seem consistent with the first two rules.
A detailed discussion and proofs of these three rules is given by \cite{ref:stability_rules_thorne}.
As we speculated when we derived the necessary stability criterion \eqref{eq:nstars:stability_mass_pressure}, stability does indeed change of character at the mass extrema of the mass-radius curve.
Thus, the maximum mass is not only a limit on \emph{massiveness}, but also on \emph{stability}.


\begin{figure}[b!]
\centering
\pgfplotsset{
	/pgfplots/colormap={stability}{rgb255=(65,171,93) rgb255=(254,178,76) rgb255=(252,78,42) rgb255=(122,1,119)}
}
\tikzsetnextfilename{mass-radius-stability}
\begin{tikzpicture}
\begin{groupplot}[
	group style={group size=1 by 1, vertical sep=10pt},
	width=15cm, height=12cm,
	xlabel=$R \, / \, \si{\kilo\meter}$, ylabel=$M \, / \, \solarmass$,
	grid=major,
	colormap name=stability, colormap access=const,
	point meta=explicit, point meta min=-0.5, point meta max=3.5,
	every axis title/.style={at={(0.97,0.95)}, text width=3cm, anchor=north east, draw=black, fill=white},
	xmin=0, xmax=50, ymin=0, ymax=0.8,
]
\nextgroupplot[
	colorbar horizontal, colorbar sampled, colorbar style={xlabel={$n =$ number of unstable modes with $\omega_n^2 < 0$}, xtick={0, 1, 2, 3}, xticklabels={$0$, $1$, $2$, $3$}, at={(0.5,1.05)}, anchor=south, xticklabel pos=upper, tickwidth=0},
	minor x tick num=4, minor y tick num=9,
]
\addplot [mesh, very thick] table [x expr={10*\thisrow{R}}, y=M, meta=nu] {../code/data/gr.dat}
node [text=black, sloped, pos=0.66, yshift=10pt] {$\longleftarrow$ Increasing $P_c$};
%\addplot [solid, very thick, domain=0:50, restrict y to domain=0:1] {4*x/(9*0.14766696910334393)}; % Buchdal bound invisible

% decorate does not work with mesh, so redraw for arrows only!
%\addplot [draw=none, very thick, decoration={markings, mark=between positions 0.05 and 0.85 step 0.2 with {\arrow[scale=1.5]{stealth}}}, postaction=decorate] table [x expr={10*\thisrow{R}}, y=M, meta=nu] {../code/data/gr2.dat}

\iffalse % Exact results are now extremely similar to computed results
\nextgroupplot[
	title={\subcaption{\label{fig:nstars:stability_exact}Exact}},
	xlabel=$R / \si{\kilo\meter}$,
]
\addplot [mark=none, mesh, thick] table [x expr={10*\thisrow{R}}, y=M, meta expr={greater(\thisrow{P},0.8) + greater(\thisrow{P},600) + greater(\thisrow{P},19000)}] {../code/data/gr2.dat};
\fi
\end{groupplot}
\end{tikzpicture}

\caption{\label{fig:nstars:stability}%
Stability analysis of the relativistic neutron star sequence with the general equation of state in \cref{fig:nstars:massradius}.
For each star, squared eigenfrequencies $\omega_n^2$ of the Sturm-Liouville problem \eqref{eq:nstars:sturm_liouville_problem} are computed numerically with shooting method,
and the number of unstable modes $n$ with $\omega_n^2 < 0$ displayed.
For $n \geq 1$ unstable modes, it is \emph{theoretically} possible for a star to vibrate in a greater-than-$n$-th stable normal mode.
However, in \emph{practice} any real-world vibration should activate \emph{all} vibration modes to some extent.
Therefore, we say that a star is stable only if it has $n = 0$ unstable modes.
%Note the presence of a third mode inside the spiral!
}

\end{figure}

\section{Summary}

The main result of this chapter is the bottom sequence of ideal neutron stars in \cref{fig:nstars:massradius} that we obtained by numerically integrating the Tolman-Oppenheimer-Volkoff equations \eqref{eq:tov:tovsys} with the general equation of state \eqref{eq:nstars:gr_eos}.
Unlike the Newtonian curves, general relativity produces an upper mass limit $M \approx 0.71 \solarmass$.
Finally, we used the shooting method to solve a Sturm-Liouville problem describing stars perturbed from equilibrium, yielding the number of unstable normal pulsation modes for all stars on the sequence.
%As we speculated when we derived the necessary stability criterion \eqref{eq:nstars:stability_mass_pressure}, stability dramatically changes character at the mass extrema on the mass-radius curve.
%The neutron stars acquire one unstable mode at every extremum, so the only stable configurations are those with central pressure below that corresponding to the upper mass limit.
\Cref{fig:nstars:stability} showed that the only stable neutron stars are those with central pressure below that corresponding to the maximum mass.

%\TODO{keywords: $dp/d\epsilon = 1/3$ = conformal limit? no mass in this EOS = scale invariance. $T^{\mu \nu}$ traceless?}
