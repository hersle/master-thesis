\documentclass[a4paper,11pt,twoside]{report}

\overfullrule=5pt % draw overfull hboxes for visual inspection

\usepackage[
	%showframe, % show frame for page margins etc.
	scale=0.75, % fraction of page width/height to use
	headheight=30pt,
]{geometry}

\usepackage{ifdraft}
%\usepackage[utf8]{inputenc} % ignored with lualatex / xelatex (which are utf8-based)
\usepackage{amsmath}
\usepackage{tensor}
\usepackage{braket}
\usepackage[parfill]{parskip} % new paragraph: new line, no indent
%\usepackage[title]{appendix}
\usepackage[hidelinks]{hyperref} % hide colored boxes around links
\usepackage[noabbrev]{cleveref}

\usepackage[labelfont=bf]{caption} % figure title in bold
\usepackage[labelfont=bf]{subcaption} % figure title in bold
%\captionsetup{subrefformat=parens}
\DeclareCaptionLabelFormat{bold}{\textbf{(#2)}}
\captionsetup{subrefformat=bold}

\usepackage{graphicx}
\usepackage[usetransparent=false,inkscapepath=.cachesvginkscape/]{svg}

%\usepackage{unicode-math} % make code display utf8 characters properly (seems that only fontspec below is enough?)
%\setmonofont{DejaVu Sans Mono} % will affect whole document, including URLs etc.
\usepackage{fontspec}
\newfontfamily\codefont{DejaVu Sans Mono}[NFSSFamily=CodeFamily] % set mono font for minted code only
\ifdraft{
	\usepackage{fancyvrb} % fast, but ugly
	\fvset{fontfamily=CodeFamily}
	\fvset{fontsize=\scriptsize}
	\fvset{frame=single}
	\newcommand{\codefile}[2]{\VerbatimInput{#2}}
}{
	\usepackage[cachedir=.cacheminted/]{minted} % nice, but slow
	%\setminted{breaklines}
	\setminted{frame=single}
	\setminted{breakanywhere}
	\setminted{fontfamily=CodeFamily}
	\setminted{fontsize=\scriptsize}
	\newcommand{\codefile}[2]{\inputminted{#1}{#2}}
}

\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhf{}
\fancyhead[LE,RO]{\textbf{\thepage}}
\fancyhead[RE]{\leftmark}
\fancyhead[LO]{\rightmark}
\fancyfoot[CE,CO]{}

\usepackage{tikz}
\usetikzlibrary{external}

% OLD. I did this before. But did not play well after adding -output-directory option.
% \tikzexternalize[prefix=.cachetikz/] % DO NOT USE DIRECTORY NAME WITH _ (. seems ok after changing .latexmkrc)

% NEW. Dirty fix for using -output-directory option. From https://tex.stackexchange.com/a/338560
\tikzexternalize
\tikzset{%
external/system call={xelatex \tikzexternalcheckshellescape --halt-on-error --interaction=batchmode --output-directory=./.cachelatex --jobname "\image" "\texsource"},
	/pgf/images/include external/.code={%
		\includegraphics{.cachelatex/#1}%
	},
}

\usepackage{pgfplots}
% NOTE: externalization does NOT recompile when only the global options below are changed
\pgfplotsset{
	compat=1.17,
	% Using title={\subcaption{...}} REQUIRES text width to be set, otherwise it throws hard-to-understand errors
	% TODO: the contents of title={...} MUST change for the externalization library to recompile the figure
	every axis title/.style={at={(0.5,1)}, above=1ex, text width=0.8*\pgfkeysvalueof{/pgfplots/width}]},
}
\usepgfplotslibrary{groupplots}

%\fancypagestyle{plain}{\pagestyle{fancy}} % make chapter front pages, bibliography etc. use same style as other pages (see https://tex.stackexchange.com/a/10046)

% make consistent style also on chapter first pages, bibliography etc.
\fancypagestyle{plain}{
	\fancyhf{}
	\fancyhead[LE,RO]{\textbf{\thepage}}
}

\usepackage[style=alphabetic]{biblatex}
\DeclareFieldFormat{urldate}{} % do not show URL access date TODO: do I have to show it?
\addbibresource{project.bib}

\usepackage{derivative}
\derivset{\odv}[style-inf=\mathrm] % write normal derivatives with upright d
%\derivset{\odv}[switch-/=true]

\newcommand\dif{\mathop{}\!\mathrm{d}}
\newcommand{\abs}[1]{\lvert #1 \rvert}
\renewcommand{\det}[1]{\abs{#1}}
\newcommand{\integral}[4]{\int_{#3}^{#4} #1 \dif #2}
\newcommand{\variation}[1]{\delta #1}
\newcommand{\trace}[1]{\text{tr} #1}
\newcommand{\lagr}{\mathcal{L}}
\newcommand{\ham}{\mathcal{H}}
\newcommand{\diag}[1]{\text{diag} \left( #1 \right)}
\newcommand{\taylor}{\simeq}
%\AtBeginDocument{\renewcommand{\vec}[1]{\mathbf{#1}}} % NB: need AtBeginDocument due to unicode-math: https://tex.stackexchange.com/a/457845
\renewcommand{\vec}[1]{\mathbf{#1}} % don't need AtBeginDocument now that I use fontspec instead of unicode-math
\newcommand{\bigo}{\mathcal{O}}
\newcommand\pathintdif{\mathcal{D}}
\newcommand{\pathint}[2]{\int \pathintdif #1 \, #2}
\newcommand{\comm}[2]{[ #1 , #2 ]}
\newcommand{\acomm}[2]{\{ #1 , #2 \}}
\newcommand{\thermalavg}[1]{ \left< #1 \right>}

% useful intro to Latex thesis: https://www.overleaf.com/learn/latex/How_to_Write_a_Thesis_in_LaTeX_(Part_1):_Basic_Structure

\title{Project thesis}
\author{Herman Sletmoen}
\date{\today}

\begin{document}

\maketitle
\tableofcontents
\input{prologue/prologue.tex}
\input{chapter1/chapter1.tex}
\input{chapter2/chapter2.tex}
\input{appendix/appendix.tex}

\printbibliography

\end{document}
